<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trimble 2026 Success Plan</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary': '#0063a3',      // Trimble Blue
                        'primary-hover': '#004a7c', 
                        'accent': '#fbad26',       // Trimble Amber
                        'primary-text': '#252a2e', // Dark Gray
                        'icon-people': '#6f42c1',  
                        'icon-pipeline': '#007bff',
                        'icon-prod': '#fd7e14',    
                    },
                    fontFamily: {
                        'sans': ['Open Sans', 'sans-serif']
                    },
                    animation: {
                        fadeIn: 'fadeIn 0.4s ease-out forwards',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
        /* Global Styles */
        body {
            font-family: 'Open Sans', sans-serif;
            color: #252a2e;
            background-color: #f3f4f6;
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }

        /* --- Blue Wave Background --- */
        .wave-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 350px;
            background-color: #0063a3;
            z-index: 0; 
        }
        .wave-svg {
            position: absolute;
            bottom: -1px;
            left: 0;
            width: 100%;
            height: auto;
            display: block;
        }

        /* --- Main Card --- */
        .main-card {
            position: relative;
            z-index: 10;
            background-color: white;
            border-radius: 0.75rem;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
            width: 95%;
            max-width: 64rem;
            margin: 5rem auto; 
            padding: 0;
            overflow: hidden;
        }
        
        .card-content {
            padding: 2.5rem;
        }

        /* Typography Enforcement */
        h1, h2, h3, h4, h5, h6 { color: #252a2e !important; }

        /* Tooltips - UPDATED FOR VISIBILITY */
        .tooltip-trigger {
            display: inline-flex; 
            align-items: center; 
            justify-content: center;
            width: 1.25rem; height: 1.25rem; 
            margin-left: 0.5rem; 
            background-color: #0063a3; /* High Contrast Blue */
            color: white;
            font-family: sans-serif; 
            font-weight: bold; 
            font-style: normal;
            border-radius: 50%; 
            cursor: help; 
            font-size: 0.75rem; 
            position: relative;
        }
        .tooltip-trigger::after {
            content: attr(data-tooltip); position: absolute; bottom: 140%; left: 50%;
            transform: translateX(-50%); background-color: #252a2e; color: white;
            font-family: sans-serif; font-size: 0.75rem; font-weight: 500; font-style: normal;
            padding: 0.5rem 0.75rem; border-radius: 0.25rem; width: 220px;
            opacity: 0; visibility: hidden; transition: all 0.2s; pointer-events: none; z-index: 50;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
            line-height: 1.4;
        }
        .tooltip-trigger:hover::after { opacity: 1; visibility: visible; }

        /* Inputs */
        .input-label { display: flex; align-items: center; font-size: 0.875rem; font-weight: 700; color: #252a2e; margin-bottom: 0.375rem; }
        .input-field {
            display: block; width: 100%; border-radius: 0.375rem; border: 1px solid #D1D5DB;
            padding: 0.625rem 0.75rem; box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05); color: #252a2e;
            transition: all 0.2s;
        }
        .input-field:focus { outline: none; border-color: #0063a3; ring: 2px; ring-color: rgba(0,99,163,0.2); }

        /* Buttons */
        .btn {
            display: inline-block; font-weight: 700; text-align: center; white-space: nowrap;
            vertical-align: middle; user-select: none; border: 1px solid transparent;
            padding: 0.75rem 1.5rem; font-size: 1rem; line-height: 1.5; border-radius: 0.375rem;
            transition: all 0.15s ease-in-out; cursor: pointer;
        }
        .btn-primary { background-color: #0063a3; color: white; }
        .btn-primary:hover { background-color: #004a7c; transform: translateY(-1px); box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
        
        .btn-accent { background-color: #fbad26; color: #252a2e; }
        .btn-accent:hover { background-color: #e59d20; }
        
        .btn-secondary { background-color: white; color: #B91C1C; border-color: #D1D5DB; }
        .btn-secondary:hover { background-color: #F3F4F6; }

        .btn-default { background-color: #E5E7EB; color: #252a2e; }
        .btn-default:hover { background-color: #D1D5DB; }

        /* Progress Steps - Strict Grid */
        .progress-bar-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            width: 100%;
            border-bottom: 2px solid #E5E7EB;
        }
        .progress-step { 
            padding: 0.75rem; 
            text-align: center; 
            font-size: 0.875rem; 
            font-weight: 600; 
            color: #9CA3AF; 
            border-bottom: 4px solid transparent; 
        }
        .progress-step-active { color: #0063a3; border-bottom-color: #0063a3; }

        /* Sliders */
        input[type=range] {
            -webkit-appearance: none; width: 100%; height: 8px; border-radius: 5px;
            background: #d3d3d3; outline: none; opacity: 0.7; margin-top: 1rem; margin-bottom: 0.5rem;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none; width: 20px; height: 20px; border-radius: 50%;
            background: #0063a3; cursor: pointer; transition: transform 0.1s;
        }
        input[type=range]::-webkit-slider-thumb:hover { transform: scale(1.1); }

        /* Print Optimizations */
        @media print {
            body { background: white; }
            .wave-container, #welcome-screen, #submissionModal, #navigation-buttons { display: none !important; }
            .main-card { box-shadow: none; margin: 0; width: 100%; max-width: 100%; }
            #wizard-container, .step-panel, .hidden { display: block !important; visibility: visible !important; }
            .step-panel { page-break-after: always; }
        }
    </style>
</head>
<body>

    <div class="wave-container">
        <svg class="wave-svg" viewBox="0 0 1440 320" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="none">
            <path fill="#f3f4f6" fill-opacity="1" d="M0,160L48,176C96,192,192,224,288,218.7C384,213,480,171,576,149.3C672,128,768,128,864,149.3C960,171,1056,213,1152,218.7C1248,224,1344,192,1392,176L1440,160L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path>
        </svg>
    </div>

    <div class="main-card">
        <div class="card-content">
            
            <div id="welcome-screen" class="animate-fadeIn">
                <div class="text-center space-y-8">
                    
                    <div class="space-y-2">
                        <h1 class="text-4xl font-extrabold text-primary-text">Trimble 2026 Success Plan</h1>
                        <p class="text-xl font-medium text-gray-500">Own Your Number. Build Your Path.</p>
                    </div>

                    <div class="max-w-3xl mx-auto space-y-4">
                        <h2 class="text-2xl font-bold text-primary-text">Your Plan. Your Year.</h2>
                        <p class="text-gray-600 text-lg leading-relaxed">
                            This tool is your personal coach. It helps you translate your quota into a set of clear, measurable actions you can take every day.
                        </p>
                    </div>

                    <div class="bg-blue-50 border border-blue-100 rounded-lg p-8 text-left">
                        <h3 class="text-primary-text font-bold text-xl mb-3">Why This Matters:</h3>
                        <p class="text-gray-700 mb-4 leading-relaxed">
                            This is not a one-time exercise. This plan creates the <strong>"Contract for Success"</strong> that you and your manager will use to track progress, identify gaps, and celebrate wins throughout 2026.
                        </p>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 text-left">
                        <div class="p-6 border border-gray-200 rounded-lg bg-white shadow-sm hover:shadow-md transition-shadow">
                            <div class="text-icon-people mb-4">
                                <svg class="w-10 h-10" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>
                            </div>
                            <h3 class="text-xl font-bold text-primary-text mb-2">People</h3>
                            <ul class="text-sm text-gray-600 list-disc list-inside space-y-2">
                                <li>Identify specific skill gaps</li>
                                <li>Commit to a coaching plan</li>
                            </ul>
                        </div>

                        <div class="p-6 border border-gray-200 rounded-lg bg-white shadow-sm hover:shadow-md transition-shadow">
                            <div class="text-icon-pipeline mb-4">
                                <svg class="w-10 h-10" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path></svg>
                            </div>
                            <h3 class="text-xl font-bold text-primary-text mb-2">Pipeline</h3>
                            <ul class="text-sm text-gray-600 list-disc list-inside space-y-2">
                                <li>Calculate coverage gaps</li>
                                <li>Define generation strategy</li>
                            </ul>
                        </div>

                        <div class="p-6 border border-gray-200 rounded-lg bg-white shadow-sm hover:shadow-md transition-shadow">
                            <div class="text-icon-prod mb-4">
                                <svg class="w-10 h-10" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                            </div>
                            <h3 class="text-xl font-bold text-primary-text mb-2">Productivity</h3>
                            <ul class="text-sm text-gray-600 list-disc list-inside space-y-2">
                                <li>Audit your calendar</li>
                                <li>Protect time for selling</li>
                            </ul>
                        </div>
                    </div>

                    <div class="pt-6 text-right border-t border-gray-100">
                        <button type="button" id="startBtn" class="btn btn-primary text-lg px-10 py-4 shadow-lg">
                            Start My Plan
                        </button>
                    </div>
                </div>
            </div>

            <div id="wizard-container" class="hidden animate-fadeIn">
                
                <div class="mb-10 text-center space-y-2">
                    <h1 class="text-3xl font-extrabold text-primary-text">Trimble 2026 Success Plan</h1>
                    <p class="text-lg font-bold text-gray-600">Personal Success Plan for 2026 (My Commitment)</p>
                </div>

                <div class="mb-8">
                    <div class="progress-bar-grid">
                        <div id="progress-1" class="progress-step progress-step-active">Phase 1: Baseline</div>
                        <div id="progress-2" class="progress-step">Phase 2: The Gap</div>
                        <div id="progress-3" class="progress-step">Phase 3: The Solution</div>
                        <div id="progress-4" class="progress-step">Phase 4: Review & Submit</div>
                    </div>
                </div>

                <form id="skoForm" onsubmit="return false;">

                    <div id="step-1-content" class="step-panel">
                        <section>
                            <h2 class="step-heading">Phase 1: Baseline (Look Back 2025)</h2>
                            <div class="bg-accent/10 border-l-4 border-accent p-4 mb-8 rounded text-sm text-primary-text">
                                <strong>INSTRUCTION:</strong> Enter your historical 2025 data. This creates your efficiency baseline.
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-6">
                                <div>
                                    <label class="input-label">My Name <span class="tooltip-trigger" data-tooltip="Your full name">?</span></label>
                                    <input type="text" id="personName" class="input-field" placeholder="e.g., Jane Doe">
                                </div>
                                <div>
                                    <label class="input-label">My Manager <span class="tooltip-trigger" data-tooltip="Your direct manager">?</span></label>
                                    <input type="text" id="managerName" class="input-field" placeholder="e.g., John Smith">
                                </div>
                                <div class="md:col-span-2">
                                    <label class="input-label">My Region</label>
                                    <select id="region" class="input-field">
                                        <option value="" disabled selected>Select Region</option>
                                        <option value="NA">NA (North America)</option>
                                        <option value="EMEA">EMEA</option>
                                        <option value="APAC">APAC</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="input-label">2025 Quota <span class="tooltip-trigger" data-tooltip="Your assigned quota for 2025">?</span></label>
                                    <input type="text" id="quota2025" class="input-field" placeholder="e.g., 1,000,000">
                                </div>
                                <div>
                                    <label class="input-label">2025 Bookings <span class="tooltip-trigger" data-tooltip="Total closed-won deals in 2025">?</span></label>
                                    <input type="text" id="bookings2025" class="input-field" placeholder="e.g., 1,100,000">
                                </div>
                                <div>
                                    <label class="input-label">2025 Win Rate (%) <span class="tooltip-trigger" data-tooltip="Won Opps / Total Closed Opps">?</span></label>
                                    <input type="number" id="winRate2025" class="input-field" placeholder="e.g., 25">
                                </div>
                                <div>
                                    <label class="input-label">2025 Avg. Deal Size <span class="tooltip-trigger" data-tooltip="Bookings / Number of Deals">?</span></label>
                                    <input type="text" id="avgDealSize2025" class="input-field" placeholder="e.g., 50,000">
                                </div>
                                <div class="bg-gray-50 border border-gray-200 rounded p-4 flex flex-col justify-center">
                                    <span class="text-sm font-bold text-gray-500 uppercase">2025 Attainment</span>
                                    <span id="attainment2025" class="text-3xl font-bold text-primary">0%</span>
                                </div>
                            </div>
                        </section>
                    </div>

                    <div id="step-2-content" class="step-panel hidden">
                        <section>
                            <h2 class="step-heading">Phase 2: The Gap</h2>
                            <div class="bg-accent/10 border-l-4 border-accent p-4 mb-8 rounded text-sm text-primary-text">
                                <strong>INSTRUCTION:</strong> Enter your 2026 quota. The tool will calculate the gap based on your 2025 efficiency.
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-6">
                                <div>
                                    <label class="input-label text-lg text-primary">My 2026 Quota (A) <span class="tooltip-trigger" data-tooltip="Your new quota for 2026">?</span></label>
                                    <input type="text" id="quota2026" class="input-field text-lg font-bold" placeholder="e.g., 1,200,000">
                                </div>
                                <div class="md:col-span-1 pt-8 text-gray-500 italic">
                                    If efficiency stays the same...
                                </div>
                                <div class="bg-gray-50 border border-gray-200 rounded p-4">
                                    <span class="text-sm font-bold text-gray-600">Required Pipeline (B)</span>
                                    <span id="pipelineToClose2026" class="text-3xl font-bold text-primary block mt-2">$0</span>
                                    <span class="text-xs text-gray-400">(Quota / Win Rate)</span>
                                </div>
                                <div class="bg-gray-50 border border-gray-200 rounded p-4">
                                    <span class="text-sm font-bold text-gray-600">Required Deals (C)</span>
                                    <span id="dealsToClose2026" class="text-3xl font-bold text-primary block mt-2">0</span>
                                    <span class="text-xs text-gray-400">(Pipeline / Deal Size)</span>
                                </div>
                            </div>

                            <div class="mt-8 pt-6 border-t border-gray-100">
                                <label class="input-label">How does this gap feel?</label>
                                <div class="flex gap-6 mt-3">
                                    <label class="flex items-center gap-2 cursor-pointer">
                                        <input type="radio" name="reflection" value="Achievable" class="accent-primary h-4 w-4">
                                        <span class="text-primary-text">Achievable</span>
                                    </label>
                                    <label class="flex items-center gap-2 cursor-pointer">
                                        <input type="radio" name="reflection" value="Challenging" class="accent-primary h-4 w-4">
                                        <span class="text-primary-text">Challenging</span>
                                    </label>
                                    <label class="flex items-center gap-2 cursor-pointer">
                                        <input type="radio" name="reflection" value="Impossible" class="accent-primary h-4 w-4">
                                        <span class="text-primary-text">Impossible</span>
                                    </label>
                                </div>
                            </div>
                        </section>
                    </div>

                    <div id="step-3-content" class="step-panel hidden">
                        <section>
                            <h2 class="step-heading">Phase 3: The Solution</h2>
                            
                            <div class="mb-12">
                                <h3 class="text-xl font-bold text-primary mb-4">Part A: Model Efficiency Gains</h3>
                                <div class="bg-accent/10 border-l-4 border-accent p-4 mb-6 rounded text-sm text-primary-text">
                                    <strong>INSTRUCTION:</strong> Move the sliders to see how improving Win Rate, Deal Size, or Activity reduces your pipeline burden.
                                </div>

                                <div class="space-y-8">
                                    <div class="border border-primary/30 bg-blue-50/50 p-6 rounded-lg">
                                        <h3 class="text-lg font-bold text-primary mb-4">Lever 1: Win Rate (Quality)</h3>
                                        <label class="text-sm font-semibold text-primary-text">Improve by: <span id="winRateImprovementLabel" class="text-primary font-bold">5.0%</span></label>
                                        <input type="range" id="winRateImprovement" min="0" max="25" value="5" step="0.5" class="w-full mt-2 mb-4 accent-primary">
                                        
                                        <div class="bg-white p-4 rounded border border-gray-200 flex justify-between items-center">
                                            <div>
                                                <span class="text-xs font-bold text-gray-500 uppercase">New Pipeline Needed</span>
                                                <span id="newPipelineNeeded" class="block text-2xl font-bold text-primary mt-1">$0</span>
                                            </div>
                                            <div class="text-right">
                                                <span class="text-xs font-bold text-gray-500 uppercase">New Coverage</span>
                                                <span id="newPipelineCoverage" class="block text-xl font-bold text-gray-700 mt-1">0.0x</span>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="border border-gray-200 bg-gray-50 p-6 rounded-lg">
                                        <h3 class="text-lg font-bold text-primary-text mb-4">Lever 2: Deal Size (Value)</h3>
                                        <label class="text-sm font-semibold text-primary-text">Improve by: <span id="dealSizeImprovementLabel" class="text-primary-text font-bold">15%</span></label>
                                        <input type="range" id="dealSizeImprovement" min="0" max="50" value="15" step="1" class="w-full mt-2 mb-4 accent-gray-500">
                                        
                                        <div class="bg-white p-4 rounded border border-gray-200">
                                            <span class="text-xs font-bold text-gray-500 uppercase">New Deals Needed</span>
                                            <span id="newDealsNeeded" class="block text-2xl font-bold text-primary-text mt-1">0</span>
                                        </div>
                                    </div>
                                    
                                    <div class="border border-gray-200 bg-gray-50 p-6 rounded-lg">
                                        <h3 class="text-lg font-bold text-primary-text mb-4">Lever 3: Meetings (Activity)</h3>
                                        <label class="text-sm font-semibold text-primary-text">Increase Quarterly Meetings by: <span id="meetingImprovementLabel" class="text-primary-text font-bold">5</span></label>
                                        <input type="range" id="meetingImprovement" min="0" max="20" value="5" step="1" class="w-full mt-2 mb-4 accent-gray-500">
                                        
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            <div>
                                                <label class="block text-xs font-bold text-gray-500 mb-1">Implied New Win Rate (%)</label>
                                                <input type="number" id="meetingsImpliedWinRate" class="input-field" placeholder="e.g., 28">
                                            </div>
                                            <div class="bg-white p-3 rounded border border-gray-200">
                                                <span class="text-xs font-bold text-gray-500 uppercase">New Pipeline Needed</span>
                                                <span id="meetingsPipelineNeeded" class="block text-xl font-bold text-primary-text mt-1">$0</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <hr class="border-gray-200 my-10">

                            <div class="mb-8">
                                <h3 class="text-xl font-bold text-primary mb-4">Part B: Build Your Plan</h3>
                                <div class="bg-accent/10 border-l-4 border-accent p-4 mb-6 rounded text-sm text-primary-text">
                                    <strong>INSTRUCTION:</strong> Define your commitments for People, Pipeline, and Productivity.
                                </div>

                                <div class="space-y-6">
                                    <div>
                                        <label class="input-label mb-3">My Primary Focus Lever</label>
                                        <div class="flex flex-wrap gap-4">
                                            <label class="flex items-center gap-2 cursor-pointer border p-3 rounded hover:bg-gray-50">
                                                <input type="radio" name="primaryGoal" value="Win Rate" class="accent-primary h-4 w-4">
                                                <span class="text-sm font-semibold">Win Rate</span>
                                            </label>
                                            <label class="flex items-center gap-2 cursor-pointer border p-3 rounded hover:bg-gray-50">
                                                <input type="radio" name="primaryGoal" value="Avg. Deal Size" class="accent-primary h-4 w-4">
                                                <span class="text-sm font-semibold">Deal Size</span>
                                            </label>
                                            <label class="flex items-center gap-2 cursor-pointer border p-3 rounded hover:bg-gray-50">
                                                <input type="radio" name="primaryGoal" value="All Three" class="accent-primary h-4 w-4">
                                                <span class="text-sm font-semibold">All Three</span>
                                            </label>
                                        </div>
                                    </div>

                                    <div>
                                        <label class="input-label">Action: People (Skills/Coaching)</label>
                                        <input type="text" id="action-people" class="input-field" placeholder="e.g., Complete PIC certification by Q2...">
                                    </div>
                                    <div>
                                        <label class="input-label">Action: Pipeline (Generation)</label>
                                        <input type="text" id="action-pipeline" class="input-field" placeholder="e.g., Disqualify 20% more deals before demo...">
                                    </div>
                                    <div>
                                        <label class="input-label">Action: Productivity (Time)</label>
                                        <input type="text" id="action-productivity" class="input-field" placeholder="e.g., Block 2 hours on Fridays for admin...">
                                    </div>
                                    <div class="pt-6 border-t border-gray-100">
                                        <label class="input-label">Forecasting Commitment</label>
                                        <input type="text" id="action-forecast" class="input-field" placeholder="e.g., Murder-board my commit list before submitting...">
                                    </div>
                                </div>
                            </div>
                        </section>
                    </div>

                    <div id="step-4-content" class="step-panel hidden">
                        <section>
                            <h2 class="step-heading">Phase 4: Review & Submit</h2>
                            <div class="bg-accent/10 border-l-4 border-accent p-4 mb-8 rounded text-sm text-primary-text">
                                <strong>INSTRUCTION:</strong> Review your plan. Click <strong>Submit to HQ</strong> to officially commit to this plan in Google Forms.
                            </div>
                            
                            <div id="commitmentSummaryOutput" class="bg-gray-50 border border-gray-300 rounded p-6 font-mono text-sm whitespace-pre-wrap text-gray-800"></div>
                        </section>
                    </div>

                    <div id="navigation-buttons" class="mt-12 pt-6 border-t border-gray-200 flex justify-between">
                        <button type="button" id="prevButton" class="btn btn-default hidden">Previous</button>
                        <div class="flex-grow"></div>
                        <div class="flex gap-3">
                            <button type="button" id="resetButton" class="btn btn-secondary hidden">Start Over</button>
                            <button type="button" id="printButton" class="btn btn-default hidden">Save PDF</button>
                            <button type="button" id="copyCommitmentButton" class="btn btn-default hidden">Copy Text</button>
                            <button type="button" id="submitToHQButton" class="btn btn-accent hidden shadow-lg font-bold">Submit to HQ</button>
                            <button type="button" id="nextButton" class="btn btn-primary px-8">Next</button>
                        </div>
                    </div>

                </form>
            </div>
        </div>
    </div>

    <div id="submissionModal" class="fixed inset-0 bg-gray-900 bg-opacity-75 hidden items-center justify-center z-50">
        <div class="bg-white rounded-lg shadow-2xl p-8 max-w-md w-full mx-4 border-t-4 border-accent">
            <h3 class="text-2xl font-bold text-primary-text mb-4">Almost Done!</h3>
            <p class="text-gray-600 mb-8 text-base leading-relaxed">
                We are about to open a <strong>Google Form</strong> in a new tab with your data pre-filled.
                <br><br>
                Please <strong>REVIEW</strong> the numbers in that form and click the <strong>SUBMIT</strong> button there to finalize your commitment.
            </p>
            <div class="flex justify-end gap-4 pt-4 border-t border-gray-100">
                <button id="cancelModalBtn" class="btn btn-default">Go Back</button>
                <button id="confirmModalBtn" class="btn btn-accent font-bold">Open Google Form</button>
            </div>
        </div>
    </div>

<script>
    // --- 1. Config ---
    const GOOGLE_FORM_CONFIG = {
        baseUrl: "https://docs.google.com/forms/d/e/1FAIpQLSdVizNI9jeThAxWU2FjxTcqaVfdsnXqaDbbDMzHg8Y4gGX1Hg/viewform",
        fields: {
            repName: "entry.1533888544", managerName: "entry.2004467893", region: "entry.909220528",
            quota2026: "entry.1187258724", targetWinRate: "entry.516044971", targetCoverage: "entry.10775378",
            primaryGoal: "entry.1090213679", peoplePlan: "entry.1667466065", pipelinePlan: "entry.1553800751",
            productivityPlan: "entry.1571167359", forecastCommit: "entry.962991132"
        }
    };

    const $ = (id) => document.getElementById(id);

    // --- 2. View Controller ---
    const views = {
        welcome: $('welcome-screen'),
        wizard: $('wizard-container')
    };

    function initViews() {
        views.welcome.style.display = 'block';
        views.wizard.classList.add('hidden');
        window.scrollTo(0,0);
    }

    $('startBtn').addEventListener('click', () => {
        views.welcome.style.display = 'none';
        views.wizard.classList.remove('hidden');
        window.scrollTo(0,0);
    });

    // --- 3. Logic & Math ---
    const getNum = (id) => { const v = $(id).value.replace(/[$,]/g,''); return parseFloat(v) || 0; };
    const getStr = (id) => $(id).value.trim();
    const getSel = (n) => { const c = document.querySelector(`input[name="${n}"]:checked`); return c ? c.nextElementSibling.innerText.trim() : 'Not Selected'; };
    
    const formatCurrency = (n) => isFinite(n) ? '$'+n.toLocaleString('en-US',{maximumFractionDigits:0}) : '$0';
    const formatPercent = (n) => isFinite(n) ? n.toFixed(1)+'%' : '0%';
    const formatNumber = (n) => isFinite(n) ? n.toLocaleString('en-US',{maximumFractionDigits:1}) : '0';
    const formatCoverage = (n) => isFinite(n) ? n.toFixed(1)+'x' : '0.0x';

    function calc() {
        const q25 = getNum('quota2025'), b25 = getNum('bookings2025'), wr25 = getNum('winRate2025'), ads25 = getNum('avgDealSize2025');
        const q26 = getNum('quota2026');
        const levWR = getNum('winRateImprovement'), levADS = getNum('dealSizeImprovement'), levMtg = getNum('meetingImprovement'), impWR = getNum('meetingsImpliedWinRate');

        // Phase 1
        $('attainment2025').textContent = formatPercent(q25>0 ? (b25/q25)*100 : 0);

        // Phase 2
        const wrDec = wr25/100;
        const pipe26 = wrDec>0 ? q26/wrDec : 0;
        $('pipelineToClose2026').textContent = formatCurrency(pipe26);
        $('dealsToClose2026').textContent = formatNumber(ads25>0 ? pipe26/ads25 : 0);

        // Phase 3 - Solution
        const newWR = wr25 + levWR;
        const newPipeWR = (newWR/100)>0 ? q26/(newWR/100) : 0;
        $('winRateImprovementLabel').textContent = levWR.toFixed(1) + '% (Target: ' + newWR.toFixed(1) + '%)';
        $('newPipelineNeeded').textContent = formatCurrency(newPipeWR);
        $('newPipelineCoverage').textContent = formatCoverage(q26>0 ? newPipeWR/q26 : 0);

        $('dealSizeImprovementLabel').textContent = levADS.toFixed(0) + '%';
        const newADS = ads25 * (1 + levADS/100);
        $('newDealsNeeded').textContent = formatNumber(newADS>0 ? q26/newADS : 0);

        $('meetingImprovementLabel').textContent = levMtg;
        const pipeMtg = (impWR/100)>0 ? q26/(impWR/100) : 0;
        $('meetingsPipelineNeeded').textContent = formatCurrency(pipeMtg);

        if(currStep === 4) summary(); // Update summary if on last step
    }

    function summary() {
        const txt = `
**TRIMBLE 2026 SALES PLAN**

**1. Baseline**
- Rep: ${getStr('personName')} | Manager: ${getStr('managerName')} | Region: ${$('region').value}
- 2026 Quota: ${formatCurrency(getNum('quota2026'))}
- 2025 Win Rate: ${getNum('winRate2025')}%

**2. Strategy**
- Primary Lever: ${getSel('primaryGoal')}
- Target Win Rate: ${(getNum('winRate2025')+getNum('winRateImprovement')).toFixed(1)}%

**3. Actions**
- People: ${getStr('action-people')}
- Pipeline: ${getStr('action-pipeline')}
- Productivity: ${getStr('action-productivity')}
- Forecast: ${getStr('action-forecast')}
        `.trim();
        $('commitmentSummaryOutput').textContent = txt;
        return txt;
    }

    function submitForm() {
        const c = GOOGLE_FORM_CONFIG;
        const wr = getNum('winRate2025') + getNum('winRateImprovement');
        const cov = wr>0 ? (1/(wr/100)).toFixed(1) : "0.0";
        
        const url = `${c.baseUrl}?${c.fields.repName}=${encodeURIComponent(getStr('personName'))}` +
            `&${c.fields.managerName}=${encodeURIComponent(getStr('managerName'))}` +
            `&${c.fields.region}=${encodeURIComponent($('region').value)}` +
            `&${c.fields.quota2026}=${encodeURIComponent(getNum('quota2026'))}` +
            `&${c.fields.targetWinRate}=${encodeURIComponent(wr)}` +
            `&${c.fields.targetCoverage}=${encodeURIComponent(cov)}` +
            `&${c.fields.primaryGoal}=${encodeURIComponent(getSel('primaryGoal'))}` +
            `&${c.fields.peoplePlan}=${encodeURIComponent(getStr('action-people'))}` +
            `&${c.fields.pipelinePlan}=${encodeURIComponent(getStr('action-pipeline'))}` +
            `&${c.fields.productivityPlan}=${encodeURIComponent(getStr('action-productivity'))}` +
            `&${c.fields.forecastCommit}=${encodeURIComponent(getStr('action-forecast'))}`;
            
        window.open(url, '_blank');
        $('submissionModal').classList.remove('flex');
        $('submissionModal').classList.add('hidden');
    }

    // --- 4. Init & Events ---
    let currStep = 1;
    const steps = 4; // STRICT 4 STEPS

    function goStep(s) {
        // Scroll to top of wizard
        window.scrollTo({ top: 0, behavior: 'smooth' });

        if(s === 4) summary();
        
        // Hide all steps
        for(let i=1; i<=steps; i++) {
            const el = $(`step-${i}-content`);
            if(el) el.classList.add('hidden');
            const bar = $(`progress-${i}`);
            if(bar) bar.classList.remove('progress-step-active');
        }
        
        // Show current step
        $(`step-${s}-content`).classList.remove('hidden');
        
        // Highlight bars up to current step
        for(let i=1; i<=s; i++) {
             const bar = $(`progress-${i}`);
             if(bar) bar.classList.add('progress-step-active');
        }
        
        // Manage Button Visibility
        const isFirst = s===1;
        const isLast = s===steps;
        
        $('prevButton').classList.toggle('hidden', isFirst);
        $('nextButton').classList.toggle('hidden', isLast);
        
        // Final buttons only on last step
        $('submitToHQButton').classList.toggle('hidden', !isLast);
        $('copyCommitmentButton').classList.toggle('hidden', !isLast);
        $('printButton').classList.toggle('hidden', !isLast);
        $('resetButton').classList.toggle('hidden', !isLast);
        
        // Auto-focus header for accessibility
        const h = $(`step-${s}-content`).querySelector('h2');
        if(h) h.focus();
    }

    document.addEventListener('DOMContentLoaded', () => {
        initViews(); 
        
        ['quota2025','bookings2025','winRate2025','avgDealSize2025','quota2026',
         'winRateImprovement','dealSizeImprovement','meetingImprovement','meetingsImpliedWinRate']
         .forEach(id => $(id)?.addEventListener('input', calc));

        $('nextButton').onclick = () => { if(currStep < steps) goStep(++currStep); };
        $('prevButton').onclick = () => { if(currStep > 1) goStep(--currStep); };
        $('resetButton').onclick = () => { $('skoForm').reset(); calc(); currStep=1; goStep(1); };
        $('printButton').onclick = () => window.print();
        $('copyCommitmentButton').onclick = () => {
             navigator.clipboard.writeText(summary()).then(()=>{
                 const b=$('copyCommitmentButton'); const t=b.innerText; b.innerText='Copied!'; setTimeout(()=>b.innerText=t,1500);
             });
        };
        $('submitToHQButton').onclick = () => { $('submissionModal').classList.remove('hidden'); $('submissionModal').classList.add('flex'); };
        $('confirmModalBtn').onclick = submitForm;
        $('cancelModalBtn').onclick = () => { $('submissionModal').classList.add('hidden'); $('submissionModal').classList.remove('flex'); };

        calc();
    });
</script>
</body>
</html>
