<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trimble 2026 Success Plan</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary': '#0063a3',      // Trimble Blue
                        'primary-hover': '#004a7c',
                        'accent': '#fbad26',       // Trimble Yellow
                        'primary-text': '#252a2e', // Dark Gray
                        'soft-bg': '#f3f6f9',      // Light Gray
                        'error-red': '#e11d48',    // Softer Red
                    },
                    fontFamily: {
                        'sans': ['Open Sans', 'sans-serif']
                    }
                }
            }
        }
    </script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
        /* BASE STYLES */
        body {
            font-family: 'Open Sans', sans-serif;
            color: #252a2e; 
            background-color: #f3f6f9;
        }
        
        /* FRIENDLY GUIDE BOX */
        .guide-box {
            @apply bg-blue-50 border-l-4 border-primary text-primary-text p-6 mb-8 rounded-r-md text-sm leading-relaxed shadow-sm;
        }
        .guide-box h3 {
            @apply font-bold text-primary text-base mb-2;
        }

        /* INPUT FIELDS */
        .input-label {
            display: block;
            font-size: 0.95rem; font-weight: 700; color: #374151; margin-bottom: 0.25rem;
        }
        .input-sublabel {
            display: block; font-size: 0.85rem; color: #6b7280; margin-bottom: 0.5rem; font-style: italic;
        }
        .input-field {
            display: block; width: 100%;
            border-radius: 0.5rem; border: 1px solid #d1d5db;
            padding: 0.75rem 1rem; font-size: 1rem;
            transition: all 0.2s;
        }
        .input-field:focus {
            outline: none; border-color: #0063a3; ring: 3px; ring-color: #e0f2fe;
            box-shadow: 0 0 0 3px rgba(0, 99, 163, 0.1);
        }
        
        /* SLIDERS */
        .slider-group { @apply mb-6; }
        input[type=range] {
            -webkit-appearance: none; width: 100%; height: 8px;
            border-radius: 5px; background: #e5e7eb; outline: none;
            margin: 0.5rem 0; cursor: pointer;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none; width: 24px; height: 24px;
            border-radius: 50%; background: #0063a3; cursor: pointer;
            border: 2px solid white; box-shadow: 0 2px 6px rgba(0,0,0,0.2); 
            margin-top: -8px; 
        }

        /* VALIDATION STATES */
        .input-error { border-color: #e11d48 !important; background-color: #fff1f2; }
        .error-text {
            display: none; color: #e11d48; font-size: 0.8rem; margin-top: 0.4rem; font-weight: 600;
        }
        .error-text.show { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }

        /* SWOOP HEADER */
        .header-swoop {
            background-color: #0063a3;
            width: 100%; height: 220px;
            position: absolute; top: 0; left: 0; z-index: 0; overflow: hidden;
        }
        .header-swoop svg {
            width: 100%; height: 100%; position: absolute; bottom: -1px; left: 0;
        }

        /* PROGRESS TABS */
        .progress-container { display: flex; border-bottom: 1px solid #e5e7eb; margin-bottom: 0; }
        .progress-step {
            flex: 1; text-align: center; padding: 1rem;
            font-size: 0.8rem; font-weight: 700; color: #9ca3af; letter-spacing: 0.05em;
            border-bottom: 4px solid transparent; transition: all 0.3s;
        }
        .progress-step.active { color: #0063a3; border-bottom-color: #0063a3; }
        .progress-step.completed { color: #0063a3; opacity: 0.6; }

        /* BUTTONS */
        .btn {
            padding: 0.75rem 1.5rem; border-radius: 0.5rem; font-weight: 600;
            transition: all 0.2s; cursor: pointer; text-align: center;
        }
        .btn-primary { background-color: #0063a3; color: white; box-shadow: 0 4px 6px -1px rgba(0, 99, 163, 0.2); }
        .btn-primary:hover { background-color: #004a7c; transform: translateY(-1px); }
        .btn-accent { background-color: #fbad26; color: #252a2e; }
        .btn-ghost { background-color: transparent; color: #6b7280; }
        .btn-ghost:hover { background-color: #f3f4f6; color: #1f2937; }

        /* Print adjustments */
        @media print {
            .header-swoop, #nav-area { display: none !important; }
            body { background: white; }
            .shadow-2xl { box-shadow: none; }
            .step-panel { display: block !important; }
            .hidden { display: block !important; }
            #step-0, #step-1 { display: none !important; }
        }
    </style>
</head>
<body>

    <div class="header-swoop">
        <svg viewbox="0 0 1440 320" preserveAspectRatio="none">
            <path fill="#0063a3" fill-opacity="1" d="M0,0L1440,0L1440,220L0,220Z"></path>
            <path fill="#f3f6f9" fill-opacity="1" d="M0,220L60,213.3C120,207,240,193,360,197.3C480,202,600,224,720,229.3C840,235,960,224,1080,208C1200,192,1320,171,1380,160L1440,149L1440,320L1380,320C1320,320,1200,320,1080,320C960,320,840,320,720,320C600,320,480,320,360,320C240,320,120,320,60,320L0,320Z"></path>
        </svg>
    </div>

    <div class="relative z-10 max-w-5xl mx-auto mt-16 mb-12 px-4">
        <div class="bg-white rounded-xl shadow-2xl min-h-[650px] flex flex-col relative">
            
            <div class="p-8 pb-0 text-center rounded-t-xl bg-white">
                <h1 class="text-3xl font-extrabold text-gray-800 mb-2">Trimble 2026 Success Plan</h1>
                <p class="text-gray-500 font-medium">Own Your Number. Build Your Path.</p>
            </div>

            <div id="progress-bar" class="progress-container mt-8 px-8 hidden">
                <div id="tab-baseline" class="progress-step">1. BASELINE</div>
                <div id="tab-gap" class="progress-step">2. OPPORTUNITY</div>
                <div id="tab-solution" class="progress-step">3. SOLUTION</div>
                <div id="tab-review" class="progress-step">4. REVIEW</div>
            </div>

            <div class="p-8 flex-grow">
                <form id="appForm" onsubmit="return false;">

                    <div id="step-0" class="step-content">
                        <div class="text-center max-w-3xl mx-auto space-y-8">
                            <h2 class="text-2xl font-bold text-gray-800">Your Plan. Your Year.</h2>
                            <p class="text-lg text-gray-600">
                                This tool connects your corporate target to your personal actions. By the end, you will have a specific roadmap for <strong>People, Pipeline, and Productivity</strong>.
                            </p>
                            
                            <div class="bg-gray-50 rounded-lg p-6 border border-gray-200">
                                <h3 class="font-bold text-primary mb-2">Before you start:</h3>
                                <p class="text-sm text-gray-600">
                                    Please have your <strong>Sales Scorecard</strong> open (if your role has one) to reference your 2025 actuals.
                                </p>
                            </div>
                        </div>
                    </div>

                    <div id="step-1" class="step-content hidden">
                        <div class="max-w-xl mx-auto text-center py-10">
                            <h2 class="text-2xl font-bold text-gray-800 mb-4">Select Your Role</h2>
                            <p class="text-gray-600 mb-6">We will customize the metrics and language for you.</p>
                            <div class="text-left bg-white p-6 rounded-lg border border-gray-200 shadow-sm">
                                <select id="userRole" class="input-field text-lg py-3 cursor-pointer bg-gray-50">
                                    <option value="AE">Account Executive (AE)</option>
                                    <option value="SDR">Sales Development (SDR)</option>
                                    <option value="SE">Sales Engineer (SE)</option>
                                    <option value="ECOMM">eCommerce</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div id="step-2" class="step-content hidden">
                        <div class="guide-box">
                            <h3>YOUR GUIDE: Establishing the Baseline</h3>
                            <p>We can't build a path forward without knowing where we stand. Use your <strong>2025 Scorecard</strong> to fill in these actuals. This establishes your "Efficiency Baseline."</p>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="input-label">My Name</label>
                                <input type="text" id="personName" class="input-field required" placeholder="Full Name">
                                <p class="error-text" id="err-personName">Required.</p>
                            </div>
                            <div>
                                <label class="input-label">My Manager</label>
                                <input type="text" id="managerName" class="input-field required" placeholder="Manager Name">
                                <p class="error-text" id="err-managerName">Required.</p>
                            </div>
                            <div class="md:col-span-2">
                                <label class="input-label">My Region</label>
                                <select id="region" class="input-field required">
                                    <option value="" disabled selected>Select Region...</option>
                                    <option value="NA">North America</option>
                                    <option value="EMEA">EMEA</option>
                                    <option value="APAC">APAC</option>
                                </select>
                                <p class="error-text" id="err-region">Required.</p>
                            </div>

                            <div>
                                <label class="input-label" id="lbl-quota25">2025 Quota</label>
                                <input type="text" id="val-quota25" class="input-field required" placeholder="0">
                                <p class="error-text" id="err-quota25">Required.</p>
                            </div>
                            <div>
                                <label class="input-label" id="lbl-actual25">2025 Actuals</label>
                                <input type="text" id="val-actual25" class="input-field required" placeholder="0">
                                <p class="error-text" id="err-actual25">Required.</p>
                            </div>
                            <div>
                                <label class="input-label" id="lbl-efficiency25">Win Rate %</label>
                                <div class="relative">
                                    <input type="number" id="val-efficiency25" class="input-field pr-8 required" placeholder="0">
                                    <span class="absolute right-3 top-3 text-gray-400 font-bold">%</span>
                                </div>
                                <p class="error-text" id="err-efficiency25">Required.</p>
                            </div>
                            <div>
                                <label class="input-label" id="lbl-dealSize25">Avg Deal Size</label>
                                <input type="text" id="val-dealSize25" class="input-field required" placeholder="0">
                                <p class="error-text" id="err-dealSize25">Required.</p>
                            </div>

                            <div class="md:col-span-2 mt-2">
                                <div class="bg-gray-50 border border-gray-200 rounded-lg p-4 flex items-center justify-between">
                                    <span class="text-sm font-bold text-gray-600 uppercase tracking-wide">2025 Attainment</span>
                                    <span id="calc-attainment" class="text-2xl font-extrabold text-primary">0%</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="step-3" class="step-content hidden">
                        <div class="guide-box">
                            <h3>YOUR GUIDE: The 2026 Opportunity</h3>
                            <p>Enter your <strong>2026 Target</strong>. We will calculate exactly what pipeline or activity volume you need to hit this number, assuming your efficiency stays the same as 2025.</p>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                            <div>
                                <label class="input-label" id="lbl-quota26">2026 Quota</label>
                                <input type="text" id="val-quota26" class="input-field required text-lg font-semibold text-primary" placeholder="0">
                                <p class="error-text" id="err-quota26">Required.</p>
                            </div>
                            
                            <div class="bg-blue-50 border border-blue-100 rounded-lg p-6 md:row-span-2">
                                <h4 class="text-xs font-bold text-gray-500 uppercase tracking-wide mb-4">Calculated Requirement</h4>
                                <div class="mb-6">
                                    <span id="lbl-resultA" class="block text-sm text-gray-600 mb-1 font-bold">Pipeline Needed</span>
                                    <span id="calc-resultA" class="block text-3xl font-extrabold text-primary">0</span>
                                    <span class="text-xs text-gray-500 mt-1 block">Based on current efficiency</span>
                                </div>
                                <div>
                                    <span id="lbl-resultB" class="block text-sm text-gray-600 mb-1 font-bold">Deals Needed</span>
                                    <span id="calc-resultB" class="block text-3xl font-extrabold text-primary">0</span>
                                </div>
                            </div>
                        </div>

                        <div class="mt-8">
                            <label class="input-label mb-3">Reflection: How does this goal feel right now?</label>
                            <div class="grid grid-cols-3 gap-4">
                                <label class="cursor-pointer"><input type="radio" name="reflection" value="Achievable" class="peer sr-only"><div class="p-3 text-center border rounded-md hover:bg-gray-50 peer-checked:border-primary peer-checked:bg-blue-50 peer-checked:text-primary">Achievable</div></label>
                                <label class="cursor-pointer"><input type="radio" name="reflection" value="Stretch" class="peer sr-only"><div class="p-3 text-center border rounded-md hover:bg-gray-50 peer-checked:border-primary peer-checked:bg-blue-50 peer-checked:text-primary">Stretch</div></label>
                                <label class="cursor-pointer"><input type="radio" name="reflection" value="Impossible" class="peer sr-only"><div class="p-3 text-center border rounded-md hover:bg-gray-50 peer-checked:border-primary peer-checked:bg-blue-50 peer-checked:text-primary">Ambitious</div></label>
                            </div>
                            <p id="err-reflection" class="error-text mt-2">Please make a selection.</p>
                        </div>
                    </div>

                    <div id="step-4" class="step-content hidden">
                        <div class="guide-box">
                            <h3>YOUR GUIDE: The Action Plan</h3>
                            <p><strong>Step 1: The Math.</strong> Use the sliders to model "What If" scenarios. See how small improvements (like 1-2%) reduce the pipeline/activity you need.</p>
                            <p class="mt-2"><strong>Step 2: The Method.</strong> Connect the math to reality. Use the fields below to commit to specific actions from the <strong>Best Practice Sessions</strong> that will drive these improvements.</p>
                        </div>

                        <div class="mb-10 bg-gray-50 p-6 rounded-lg border border-gray-200">
                            <h4 class="text-primary font-bold mb-6 uppercase text-xs tracking-wide">Scenario Modeling</h4>
                            
                            <div class="slider-group">
                                <div class="flex justify-between text-sm font-bold text-gray-700 mb-1">
                                    <span id="lbl-slider1">Improve Win Rate</span>
                                    <span id="val-slider1" class="text-primary">+0%</span>
                                </div>
                                <input type="range" id="slide-efficiency" min="0" max="15" value="0" step="1">
                            </div>
                            <div class="slider-group">
                                <div class="flex justify-between text-sm font-bold text-gray-700 mb-1">
                                    <span id="lbl-slider2">Increase Deal Size</span>
                                    <span id="val-slider2" class="text-primary">+0%</span>
                                </div>
                                <input type="range" id="slide-value" min="0" max="25" value="0" step="1">
                            </div>
                            <div class="slider-group">
                                <div class="flex justify-between text-sm font-bold text-gray-700 mb-1">
                                    <span id="lbl-slider3">Increase Activity Volume</span>
                                    <span id="val-slider3" class="text-primary">+0%</span>
                                </div>
                                <input type="range" id="slide-volume" min="0" max="50" value="0" step="5">
                            </div>

                            <div class="mt-6 pt-4 border-t border-gray-200 bg-white p-4 rounded-md shadow-sm border">
                                <div class="flex justify-between items-center">
                                    <div>
                                        <span id="lbl-new-vol" class="text-sm font-bold text-gray-600 block">New Pipeline Required:</span>
                                        <span class="text-xs text-gray-400">(After your improvements)</span>
                                    </div>
                                    <span id="calc-new-volume" class="text-2xl font-extrabold text-primary">0</span>
                                </div>
                            </div>
                        </div>

                        <div class="space-y-8">
                            <div>
                                <label class="input-label">People & Skills</label>
                                <span class="input-sublabel">Think back to the <strong>Team Selling</strong> session. What specific competency will you improve to hit the win rate modeled above?</span>
                                <input type="text" id="act-people" class="input-field required" placeholder="e.g., I will complete the Negotiation Certification by Q2...">
                                <p class="error-text" id="err-act-people">Required.</p>
                            </div>

                            <div>
                                <label class="input-label">Process & Pipeline</label>
                                <span class="input-sublabel">Think back to the <strong>Account Planning</strong> session. What process change will ensure better deal quality?</span>
                                <input type="text" id="act-process" class="input-field required" placeholder="e.g., I will disqualify bad deals earlier using the new rubric...">
                                <p class="error-text" id="err-act-process">Required.</p>
                            </div>

                            <div>
                                <label class="input-label">Productivity</label>
                                <span class="input-sublabel">Think back to <strong>Territory Management</strong>. How will you organize your time to ensure you hit your activity targets?</span>
                                <input type="text" id="act-prod" class="input-field required" placeholder="e.g., I will block 2 hours every Tuesday for prospecting...">
                                <p class="error-text" id="err-act-prod">Required.</p>
                            </div>

                            <div class="pt-6 border-t">
                                <label class="input-label">Forecasting Commitment</label>
                                <span class="input-sublabel">Predictability is critical. The standard is 95-105% accuracy. What is your personal commitment to achieving this?</span>
                                <input type="text" id="act-forecast" class="input-field required" placeholder="e.g. I will update my commit dates every Friday before 2pm...">
                                <p class="error-text" id="err-act-forecast">Required.</p>
                            </div>
                        </div>
                    </div>

                    <div id="step-5" class="step-content hidden">
                        <div class="guide-box">
                            <h3>YOUR GUIDE: Final Commitment</h3>
                            <p>This is your roadmap for 2026. Please export the data for your manager and save a PDF copy for yourself.</p>
                        </div>
                        <div id="summary-display" class="bg-gray-50 p-6 rounded-lg text-sm text-gray-700 font-mono whitespace-pre-wrap border border-gray-200 h-96 overflow-y-auto shadow-inner"></div>
                    </div>
                </form>
            </div>

            <div id="nav-area" class="p-6 border-t bg-gray-50 flex justify-between items-center rounded-b-xl">
                <button id="btn-prev" class="btn btn-ghost hidden">‚Üê Back</button>
                <div class="flex-grow"></div>
                <div id="final-buttons" class="hidden flex gap-3">
                    <button id="btn-restart" class="btn btn-ghost text-red-600 hover:bg-red-50">Start Over</button>
                    <button id="btn-pdf" class="btn btn-ghost border border-gray-300 bg-white">Save PDF</button>
                    <button id="btn-copy" class="btn btn-primary">Copy Text</button>
                    <button id="btn-json" class="btn btn-accent">Export Data</button>
                </div>
                <button id="btn-next" class="btn btn-primary min-w-[120px] shadow-lg">Start</button>
            </div>
        </div>
    </div>

<script>
    const ROLE_DATA = {
        'AE': {
            lbl: {
                q25: '2025 Quota', a25: '2025 Bookings', e25: 'Win Rate %', d25: 'Average Deal Size',
                q26: '2026 Quota', resA: 'Pipeline Required', resB: 'Deals Required',
                sl1: 'Improve Win Rate', sl2: 'Increase Deal Size', sl3: 'Increase Activity',
                newVol: 'New Pipeline Required'
            },
            isMoney: true
        },
        'SDR': {
            lbl: {
                q25: '2025 Target', a25: '2025 Actuals', e25: 'Conversion Rate %', d25: 'Average Opportunity Size',
                q26: '2026 Target', resA: 'Activity Required', resB: 'Est. Pipeline',
                sl1: 'Improve Conversion', sl2: 'Increase Opp Size', sl3: 'Increase Volume',
                newVol: 'New Activity Required'
            },
            isMoney: false
        },
        'SE': {
             lbl: {
                q25: '2025 Rev Target', a25: '2025 Actuals', e25: 'Tech Win Rate %', d25: 'Average Deal Size',
                q26: '2026 Rev Target', resA: 'Coverage Needed', resB: 'Deals to Support',
                sl1: 'Improve Tech Win', sl2: 'Increase Deal Size', sl3: 'Support More Deals',
                newVol: 'New Coverage Needed'
            },
            isMoney: true
        },
        'ECOMM': {
             lbl: {
                q25: '2025 Revenue', a25: '2025 Actuals', e25: 'Conversion Rate %', d25: 'Average Order Value',
                q26: '2026 Revenue', resA: 'Traffic Needed', resB: 'Transactions Needed',
                sl1: 'Improve Conversion', sl2: 'Increase Order Value', sl3: 'Increase Traffic',
                newVol: 'New Traffic Needed'
            },
            isMoney: true
        }
    };

    const $ = (id) => document.getElementById(id);
    const getVal = (id) => parseFloat($(id).value.replace(/,/g, '')) || 0;
    const setTxt = (id, txt) => { if($(id)) $(id).textContent = txt; };
    const fmtN = (n, isMon) => isMon ? n.toLocaleString('en-US', {maximumFractionDigits:0}) : n.toLocaleString('en-US', {maximumFractionDigits:1});

    let step = 0; const maxStep = 5;

    function updateLabels() {
        const r = $('userRole').value;
        const d = ROLE_DATA[r].lbl;
        
        setTxt('lbl-quota25', d.q25); setTxt('lbl-actual25', d.a25);
        setTxt('lbl-efficiency25', d.e25); setTxt('lbl-dealSize25', d.d25);
        setTxt('lbl-quota26', d.q26); setTxt('lbl-resultA', d.resA);
        setTxt('lbl-resultB', d.resB);
        setTxt('lbl-slider1', d.sl1); setTxt('lbl-slider2', d.sl2); setTxt('lbl-slider3', d.sl3);
        setTxt('lbl-new-vol', d.newVol);
    }

    function doMath() {
        const r = $('userRole').value;
        const conf = ROLE_DATA[r];

        const q25 = getVal('val-quota25'); const a25 = getVal('val-actual25');
        const att = q25 > 0 ? (a25 / q25) * 100 : 0;
        setTxt('calc-attainment', att.toFixed(1) + '%');

        const eff = getVal('val-efficiency25'); const size = getVal('val-dealSize25');
        const q26 = getVal('val-quota26');

        const impEff = parseFloat($('slide-efficiency').value);
        const impVal = parseFloat($('slide-value').value);
        const impVol = parseFloat($('slide-volume').value); // Just visual for now
        
        setTxt('val-slider1', '+' + impEff + '%'); setTxt('val-slider2', '+' + impVal + '%'); setTxt('val-slider3', '+' + impVol + '%');

        // New Simulated Metrics
        const newEff = (eff + impEff) / 100;
        const newSize = size * (1 + (impVal / 100));

        // Calc A: Volume Needed
        let valA = newEff > 0 ? q26 / newEff : 0;
        setTxt('calc-new-volume', fmtN(valA, conf.isMoney));

        // Base Gap
        const baseA = (eff/100) > 0 ? q26 / (eff/100) : 0;
        const baseB = size > 0 ? baseA / size : baseA;
        setTxt('calc-resultA', fmtN(baseA, conf.isMoney));
        setTxt('calc-resultB', fmtN(baseB, false));
    }

    function validate() {
        let valid = true;
        const panel = $(`step-${step}`);
        const inputs = Array.from(panel.querySelectorAll('.required')).filter(el => el.offsetParent !== null);
        
        inputs.forEach(inp => {
            const errId = 'err-' + inp.id.replace('val-', '').replace('act-', ''); 
            let err = document.getElementById(errId) || inp.nextElementSibling;
            
            if(inp.id === 'personName') err = $('err-personName');
            if(inp.id === 'managerName') err = $('err-managerName');
            if(inp.id === 'region') err = $('err-region');

            if(!inp.value.trim()) {
                inp.classList.add('input-error');
                if(err) err.classList.add('show');
                valid = false;
            } else {
                inp.classList.remove('input-error');
                if(err) err.classList.remove('show');
            }
        });

        if(step === 3) {
            if(!document.querySelector('input[name="reflection"]:checked')) {
                $('err-reflection').classList.add('show'); valid = false;
            } else { $('err-reflection').classList.remove('show'); }
        }
        return valid;
    }

    function navigate(dir) {
        if(dir === 1 && !validate()) return;

        $(`step-${step}`).classList.add('hidden');
        step += dir;
        $(`step-${step}`).classList.remove('hidden');

        const isStart = (step === 0);
        const isFinal = (step === maxStep);

        $('progress-bar').style.display = (step >= 2) ? 'flex' : 'none';
        if(step >= 2) {
            ['baseline','gap','solution','review'].forEach((id, i) => {
                const el = $(`tab-${id}`);
                el.className = 'progress-step';
                if(i + 2 === step) el.classList.add('active'); 
                if(i + 2 < step) el.classList.add('completed'); 
            });
        }

        const nextBtn = $('btn-next');
        const prevBtn = $('btn-prev');
        const navArea = $('nav-area');
        const finalBtns = $('final-buttons');

        if(isStart) {
            prevBtn.classList.add('hidden');
            nextBtn.textContent = 'Start';
            navArea.classList.add('justify-center'); 
        } else {
            prevBtn.classList.remove('hidden');
            navArea.classList.remove('justify-center');
        }

        nextBtn.textContent = 'Next';
        
        if(isFinal) {
            nextBtn.classList.add('hidden');
            finalBtns.classList.remove('hidden');
            generateSummary();
        } else {
            nextBtn.classList.remove('hidden');
            finalBtns.classList.add('hidden');
        }
        window.scrollTo(0,0);
        if(step > 1) doMath();
    }

    function generateSummary() {
        const txt = `TRIMBLE 2026 SUCCESS PLAN
---------------------------
Name: ${$('personName').value}
Role: ${$('userRole').value}
Region: ${$('region').value}

BASELINE (2025)
- Target: ${$('val-quota25').value}
- Actual: ${$('val-actual25').value}
- Attainment: ${$('calc-attainment').textContent}
- Efficiency: ${$('val-efficiency25').value}%

2026 GOALS
- New Target: ${$('val-quota26').value}
- Gap Volume: ${$('calc-resultA').textContent}
- Modeled Volume: ${$('calc-new-volume').textContent}
- Reflection: ${document.querySelector('input[name="reflection"]:checked')?.value}

ACTION PLAN
1. People: ${$('act-people').value}
2. Process: ${$('act-process').value}
3. Productivity: ${$('act-prod').value}
4. Accuracy: ${$('act-forecast').value}
`;
        $('summary-display').textContent = txt;
    }

    // EVENTS
    $('btn-next').onclick = () => navigate(1);
    $('btn-prev').onclick = () => navigate(-1);
    $('userRole').onchange = () => { updateLabels(); doMath(); };
    document.querySelectorAll('input').forEach(i => { i.oninput = doMath; });
    
    $('btn-restart').onclick = () => { if(confirm("Start over?")) location.reload(); };
    $('btn-copy').onclick = () => { navigator.clipboard.writeText($('summary-display').textContent); alert("Copied!"); };
    $('btn-pdf').onclick = () => window.print();
    $('btn-json').onclick = () => {
        const blob = new Blob([JSON.stringify({ plan: $('summary-display').textContent }, null, 2)], {type:'application/json'});
        const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'plan.json'; a.click();
    };

    updateLabels();
</script>

</body>
</html>
