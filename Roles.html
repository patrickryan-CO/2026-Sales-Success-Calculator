<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trimble 2026 Success Plan</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary': '#0063a3',      // Trimble Blue
                        'primary-hover': '#004a7c',
                        'accent': '#fbad26',       // Trimble Yellow
                        'primary-text': '#252a2e', // Dark Gray
                        'soft-bg': '#f3f6f9',      // Light Gray
                        'error-red': '#e11d48',    // Softer Red
                    },
                    fontFamily: {
                        'sans': ['Open Sans', 'sans-serif']
                    }
                }
            }
        }
    </script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
        /* BASE STYLES */
        body {
            font-family: 'Open Sans', sans-serif;
            color: #252a2e; 
            background-color: #f3f6f9;
        }
        
        /* FRIENDLY GUIDE BOX */
        .guide-box {
            @apply bg-blue-50 border-l-4 border-primary text-primary-text p-4 mb-8 rounded-r-md text-sm leading-relaxed;
        }
        .guide-box strong {
            color: #0063a3;
        }

        /* ANIMATED TOOLTIPS */
        .tooltip-wrapper {
            position: relative;
            display: inline-block;
            margin-left: 6px;
        }
        .tooltip-icon {
            display: inline-flex; align-items: center; justify-content: center;
            width: 18px; height: 18px;
            background-color: #9ca3af; /* Neutral Gray */
            color: white; border-radius: 50%;
            font-size: 12px; font-weight: bold; cursor: help;
            transition: background-color 0.2s;
        }
        .tooltip-icon:hover { background-color: #0063a3; }
        
        .tooltip-content {
            visibility: hidden; opacity: 0;
            position: absolute; bottom: 140%; left: 50%;
            transform: translateX(-50%) translateY(10px);
            background-color: #252a2e; color: white;
            text-align: center; padding: 8px 12px;
            border-radius: 6px; font-size: 13px; font-weight: 500;
            white-space: normal; width: 220px; z-index: 50;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            transition: all 0.2s ease-out;
            pointer-events: none;
        }
        .tooltip-content::after {
            content: ""; position: absolute; top: 100%; left: 50%;
            margin-left: -5px; border-width: 5px;
            border-style: solid;
            border-color: #252a2e transparent transparent transparent;
        }
        .tooltip-wrapper:hover .tooltip-content {
            visibility: visible; opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        /* INPUT FIELDS */
        .input-group { margin-bottom: 0; }
        .input-label {
            display: flex; align-items: center;
            font-size: 0.9rem; font-weight: 600; color: #374151; margin-bottom: 0.35rem;
        }
        .input-field {
            display: block; width: 100%;
            border-radius: 0.5rem; border: 1px solid #d1d5db;
            padding: 0.6rem 1rem; font-size: 1rem;
            transition: all 0.2s;
        }
        .input-field:focus {
            outline: none; border-color: #0063a3; ring: 2px; ring-color: #e0f2fe;
            box-shadow: 0 0 0 3px rgba(0, 99, 163, 0.1);
        }
        
        /* VALIDATION STATES */
        .input-error {
            border-color: #e11d48 !important;
            background-color: #fff1f2;
        }
        .error-text {
            display: none; color: #e11d48; font-size: 0.8rem; margin-top: 0.25rem; font-weight: 500;
        }
        .error-text.show { display: block; animation: fadeIn 0.3s; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }

        /* SWOOP HEADER */
        .header-swoop {
            background-color: #0063a3;
            width: 100%; height: 180px;
            position: absolute; top: 0; left: 0; z-index: 0;
            overflow: hidden;
        }
        .header-swoop svg {
            width: 100%; height: 100%;
            position: absolute; bottom: -1px; left: 0;
        }

        /* PROGRESS TABS */
        .progress-container {
            display: flex; border-bottom: 1px solid #e5e7eb; margin-bottom: 0;
        }
        .progress-step {
            flex: 1; text-align: center; padding: 1rem;
            font-size: 0.85rem; font-weight: 600; color: #9ca3af;
            border-bottom: 3px solid transparent; transition: all 0.3s;
        }
        .progress-step.active {
            color: #0063a3; border-bottom-color: #0063a3;
        }
        .progress-step.completed {
            color: #0063a3; opacity: 0.6;
        }

        /* BUTTONS */
        .btn {
            padding: 0.75rem 1.5rem; border-radius: 0.5rem; font-weight: 600;
            transition: all 0.2s; cursor: pointer; text-align: center;
        }
        .btn-primary { background-color: #0063a3; color: white; }
        .btn-primary:hover { background-color: #004a7c; transform: translateY(-1px); }
        .btn-accent { background-color: #fbad26; color: #252a2e; }
        .btn-accent:hover { background-color: #e59b1a; }
        .btn-ghost { background-color: transparent; color: #6b7280; }
        .btn-ghost:hover { background-color: #f3f4f6; color: #1f2937; }

        /* Print adjustments */
        @media print {
            .header-swoop, .tooltip-icon, #nav-area { display: none !important; }
            body { background: white; }
            .shadow-2xl { box-shadow: none; }
            .step-panel { display: block !important; }
        }
    </style>
</head>
<body>

    <div class="header-swoop">
        <svg viewbox="0 0 100 100" preserveAspectRatio="none">
            <path d="M0,100 C30,60 70,40 100,100 L100,0 L0,0 Z" fill="#0063a3" />
            <path d="M0,100 C50,80 80,80 100,100" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="2" />
        </svg>
    </div>

    <div class="relative z-10 max-w-4xl mx-auto mt-12 mb-12 px-4">
        
        <div class="bg-white rounded-xl shadow-2xl overflow-hidden min-h-[600px] flex flex-col">
            
            <div class="p-8 pb-0 text-center">
                <h1 class="text-3xl font-extrabold text-primary mb-2">Trimble 2026 Success Plan</h1>
                <p class="text-gray-500 font-medium">Your Personal Commitment to Success</p>
            </div>

            <div id="progress-bar" class="progress-container mt-8 px-8 hidden">
                <div id="tab-baseline" class="progress-step">BASELINE</div>
                <div id="tab-gap" class="progress-step">OPPORTUNITY</div>
                <div id="tab-solution" class="progress-step">SOLUTION</div>
                <div id="tab-review" class="progress-step">COMMITMENT</div>
            </div>

            <div class="p-8 flex-grow">
                <form id="appForm" onsubmit="return false;">

                    <div id="step-0" class="step-content">
                        <div class="text-center max-w-2xl mx-auto">
                            <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-blue-50 text-primary mb-6">
                                <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                            </div>
                            
                            <h2 class="text-2xl font-bold text-gray-800 mb-4">Let's Build Your Path to 2026</h2>
                            <p class="text-gray-600 mb-8 text-lg">
                                Welcome! This tool is here to help you translate your quota into a personal, actionable plan. 
                                By the end, you'll have a clear roadmap for <strong>People, Pipeline, and Productivity</strong> that you can own.
                            </p>

                            <div class="bg-gray-50 rounded-lg p-6 text-left border border-gray-200">
                                <h3 class="font-bold text-primary mb-3">What You'll Need to Start:</h3>
                                <p class="text-sm text-gray-600 mb-3">Please have your <strong>Sales Scorecard</strong> handy. We'll use your 2025 data to help build your 2026 plan.</p>
                                <ul class="space-y-2 text-sm text-gray-700">
                                    <li class="flex items-center"><span class="text-green-500 mr-2">✓</span> Your 2025 Quota & Bookings</li>
                                    <li class="flex items-center"><span class="text-green-500 mr-2">✓</span> Your Win Rate %</li>
                                    <li class="flex items-center"><span class="text-green-500 mr-2">✓</span> Your Average Deal Size</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div id="step-1" class="step-content hidden">
                        <div class="max-w-xl mx-auto text-center">
                            <h2 class="text-2xl font-bold text-gray-800 mb-6">First, tell us about your role.</h2>
                            <p class="text-gray-600 mb-8">This helps us customize the metrics and calculations just for you.</p>
                            
                            <div class="text-left">
                                <label class="input-label">I am a:</label>
                                <select id="userRole" class="input-field text-lg py-3 cursor-pointer">
                                    <option value="AE">Account Executive (AE)</option>
                                    <option value="SDR">Sales Development (SDR)</option>
                                    <option value="SE">Sales Engineer (SE)</option>
                                    <option value="ECOMM">eCommerce</option>
                                    <option value="COMPLIANCE">Compliance / Ops</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div id="step-2" class="step-content hidden">
                        <div class="guide-box">
                            <h3 class="font-bold mb-1">YOUR GUIDE: Looking Back</h3>
                            <p>Let's start by entering your <strong>2025 actuals</strong> from your scorecard. This establishes your personal baseline efficiency so we can build a realistic plan for next year.</p>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="input-label">My Name</label>
                                <input type="text" id="personName" class="input-field required" placeholder="e.g. Jane Doe">
                                <p class="error-text">Please enter your name.</p>
                            </div>
                            <div>
                                <label class="input-label">My Manager</label>
                                <input type="text" id="managerName" class="input-field required" placeholder="e.g. John Smith">
                                <p class="error-text">Please enter your manager's name.</p>
                            </div>
                            <div class="md:col-span-2">
                                <label class="input-label">My Region</label>
                                <select id="region" class="input-field required">
                                    <option value="" disabled selected>Select Region...</option>
                                    <option value="NA">North America</option>
                                    <option value="EMEA">EMEA</option>
                                    <option value="APAC">APAC</option>
                                </select>
                                <p class="error-text">Please select your region.</p>
                            </div>

                            <div>
                                <label class="input-label">
                                    <span id="lbl-quota25">2025 Quota</span>
                                    <div class="tooltip-wrapper">
                                        <span class="tooltip-icon">?</span>
                                        <div id="tip-quota25" class="tooltip-content">Your total assigned target for 2025.</div>
                                    </div>
                                </label>
                                <input type="text" id="val-quota25" class="input-field required" placeholder="0">
                                <p class="error-text">Please enter your target.</p>
                            </div>

                            <div>
                                <label class="input-label">
                                    <span id="lbl-actual25">2025 Actuals</span>
                                    <div class="tooltip-wrapper">
                                        <span class="tooltip-icon">?</span>
                                        <div id="tip-actual25" class="tooltip-content">Your total closed/booked amount for 2025.</div>
                                    </div>
                                </label>
                                <input type="text" id="val-actual25" class="input-field required" placeholder="0">
                                <p class="error-text">Please enter your actuals.</p>
                            </div>

                            <div>
                                <label class="input-label">
                                    <span id="lbl-efficiency25">Win Rate %</span>
                                    <div class="tooltip-wrapper">
                                        <span class="tooltip-icon">?</span>
                                        <div id="tip-efficiency25" class="tooltip-content">Percentage of opportunities that you won.</div>
                                    </div>
                                </label>
                                <div class="relative">
                                    <input type="number" id="val-efficiency25" class="input-field pr-8 required" placeholder="0">
                                    <span class="absolute right-3 top-3 text-gray-400 font-bold">%</span>
                                </div>
                                <p class="error-text">Please enter this rate.</p>
                            </div>

                            <div>
                                <label class="input-label">
                                    <span id="lbl-dealSize25">Avg Deal Size</span>
                                    <div class="tooltip-wrapper">
                                        <span class="tooltip-icon">?</span>
                                        <div id="tip-dealSize25" class="tooltip-content">The average dollar value of your closed deals.</div>
                                    </div>
                                </label>
                                <input type="text" id="val-dealSize25" class="input-field required" placeholder="0">
                                <p class="error-text">Please enter your avg size (or 0).</p>
                            </div>

                            <div class="md:col-span-2 mt-2">
                                <div class="bg-gray-50 border border-gray-200 rounded-lg p-4 flex items-center justify-between">
                                    <span class="text-sm font-bold text-gray-600">2025 Attainment:</span>
                                    <span id="calc-attainment" class="text-2xl font-extrabold text-primary">0%</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="step-3" class="step-content hidden">
                        <div class="guide-box">
                            <h3 class="font-bold mb-1">YOUR GUIDE: The 2026 Opportunity</h3>
                            <p>Now, enter your <strong>2026 Target</strong>. Based on your baseline efficiency, we'll calculate what it will take to hit this new number.</p>
                        </div>

                        <div id="calc-section">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                                <div>
                                    <label class="input-label">
                                        <span id="lbl-quota26">2026 Quota</span>
                                        <div class="tooltip-wrapper">
                                            <span class="tooltip-icon">?</span>
                                            <div class="tooltip-content">Your new target for the coming year.</div>
                                        </div>
                                    </label>
                                    <input type="text" id="val-quota26" class="input-field required text-lg font-semibold text-primary" placeholder="0">
                                    <p class="error-text">Please enter your new target.</p>
                                </div>
                                
                                <div class="bg-blue-50 border border-blue-100 rounded-lg p-6 md:row-span-2">
                                    <h4 class="text-xs font-bold text-gray-500 uppercase tracking-wide mb-4">Required to Hit Goal</h4>
                                    
                                    <div class="mb-6">
                                        <span id="lbl-resultA" class="block text-sm text-gray-600 mb-1">Pipeline Needed</span>
                                        <span id="calc-resultA" class="block text-3xl font-extrabold text-primary">0</span>
                                    </div>
                                    
                                    <div>
                                        <span id="lbl-resultB" class="block text-sm text-gray-600 mb-1">Deals Needed</span>
                                        <span id="calc-resultB" class="block text-3xl font-extrabold text-primary">0</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="mt-8">
                            <label class="input-label mb-3">Reflection: Looking at these numbers, how does this goal feel?</label>
                            <div class="grid grid-cols-3 gap-4">
                                <label class="cursor-pointer">
                                    <input type="radio" name="reflection" value="Achievable" class="peer sr-only">
                                    <div class="p-3 text-center border rounded-md hover:bg-gray-50 peer-checked:border-primary peer-checked:bg-blue-50 peer-checked:text-primary transition">
                                        Achievable
                                    </div>
                                </label>
                                <label class="cursor-pointer">
                                    <input type="radio" name="reflection" value="Stretch" class="peer sr-only">
                                    <div class="p-3 text-center border rounded-md hover:bg-gray-50 peer-checked:border-primary peer-checked:bg-blue-50 peer-checked:text-primary transition">
                                        Stretch
                                    </div>
                                </label>
                                <label class="cursor-pointer">
                                    <input type="radio" name="reflection" value="Impossible" class="peer sr-only">
                                    <div class="p-3 text-center border rounded-md hover:bg-gray-50 peer-checked:border-primary peer-checked:bg-blue-50 peer-checked:text-primary transition">
                                        Ambitious
                                    </div>
                                </label>
                            </div>
                            <p id="err-reflection" class="error-text mt-2">Please select how this feels.</p>
                        </div>
                    </div>

                    <div id="step-4" class="step-content hidden">
                        <div class="guide-box">
                            <h3 class="font-bold mb-1">YOUR GUIDE: The Action Plan</h3>
                            <p>Data is just the start. Now, let's commit to the specific actions (People, Process, Productivity) that will help you close that gap.</p>
                        </div>

                        <div class="space-y-6">
                            <div>
                                <label class="input-label">
                                    Action 1: People (Training & Coaching)
                                    <div class="tooltip-wrapper"><span class="tooltip-icon">?</span><div class="tooltip-content">What skill will you improve? e.g., "Complete Negotiation Certification."</div></div>
                                </label>
                                <input type="text" id="act-people" class="input-field required" placeholder="I will...">
                                <p class="error-text">Please add a People action.</p>
                            </div>

                            <div>
                                <label class="input-label">
                                    Action 2: Process (Pipeline & Quality)
                                    <div class="tooltip-wrapper"><span class="tooltip-icon">?</span><div class="tooltip-content">How will you improve deal quality? e.g., "Disqualify bad deals earlier."</div></div>
                                </label>
                                <input type="text" id="act-process" class="input-field required" placeholder="I will...">
                                <p class="error-text">Please add a Process action.</p>
                            </div>

                            <div>
                                <label class="input-label">
                                    Action 3: Productivity (Time & Tools)
                                    <div class="tooltip-wrapper"><span class="tooltip-icon">?</span><div class="tooltip-content">How will you work smarter? e.g., "Block 2 hours daily for prospecting."</div></div>
                                </label>
                                <input type="text" id="act-prod" class="input-field required" placeholder="I will...">
                                <p class="error-text">Please add a Productivity action.</p>
                            </div>

                            <div class="pt-6 border-t">
                                <label class="input-label">
                                    My Accuracy Commitment
                                    <div class="tooltip-wrapper"><span class="tooltip-icon">?</span><div class="tooltip-content">How will you ensure your forecast is accurate?</div></div>
                                </label>
                                <p class="text-xs text-gray-500 mb-2">"My Rep Commit will be 95-105% accurate every quarter."</p>
                                <input type="text" id="act-forecast" class="input-field required" placeholder="Key action to ensure accuracy...">
                                <p class="error-text">Please add your commitment.</p>
                            </div>
                        </div>
                    </div>

                    <div id="step-5" class="step-content hidden">
                        <div class="guide-box">
                            <h3 class="font-bold mb-1">YOUR GUIDE: Final Review</h3>
                            <p>Review your plan below. When you are ready, use the buttons below to save a copy for yourself and export the data for your manager.</p>
                        </div>

                        <div id="summary-display" class="bg-gray-50 p-6 rounded-lg text-sm text-gray-700 font-mono whitespace-pre-wrap border border-gray-200 h-96 overflow-y-auto">
                            </div>
                    </div>

                </form>
            </div>

            <div id="nav-area" class="p-6 border-t bg-gray-50 flex justify-between items-center">
                <button id="btn-prev" class="btn btn-ghost hidden">← Back</button>
                <div class="flex-grow"></div>
                
                <div id="final-buttons" class="hidden flex gap-3">
                    <button id="btn-restart" class="btn btn-ghost text-red-600">Start Over</button>
                    <button id="btn-pdf" class="btn btn-ghost border border-gray-300 bg-white">Save PDF</button>
                    <button id="btn-copy" class="btn btn-primary">Copy Text</button>
                    <button id="btn-json" class="btn btn-accent">Export Data</button>
                </div>

                <button id="btn-next" class="btn btn-primary min-w-[120px]">Start</button>
            </div>

        </div>
    </div>

<script>
    // --- DATA & CONFIG ---
    const ROLE_DATA = {
        'AE': {
            lbl: {
                q25: '2025 Quota ($)', q25tip: 'Your total assigned quota for 2025.',
                a25: '2025 Bookings ($)', a25tip: 'Your total closed/booked revenue.',
                e25: 'Win Rate %', e25tip: 'Percentage of opportunities won.',
                d25: 'Avg Deal Size ($)', d25tip: 'Your average deal value.',
                q26: '2026 Quota ($)',
                resA: 'Pipeline Needed',
                resB: 'Deals Needed'
            },
            isMoney: true
        },
        'SDR': {
            lbl: {
                q25: '2025 Target (#)', q25tip: 'Target number of meetings or SQLs.',
                a25: '2025 Actuals (#)', a25tip: 'Actual meetings/SQLs achieved.',
                e25: 'Conversion %', e25tip: 'Lead to Meeting conversion rate.',
                d25: 'Avg Opp Size ($)', d25tip: 'Average size of opps generated (optional).',
                q26: '2026 Target (#)',
                resA: 'Activity Volume Needed',
                resB: 'Est. Pipeline Generated'
            },
            isMoney: false
        },
        'SE': {
             lbl: {
                q25: '2025 Rev Target ($)', q25tip: 'Revenue target you supported.',
                a25: '2025 Actuals ($)', a25tip: 'Actual revenue supported.',
                e25: 'Tech Win Rate %', e25tip: 'Percentage of technical wins.',
                d25: 'Avg Deal Size ($)', d25tip: 'Average size of deals supported.',
                q26: '2026 Rev Target ($)',
                resA: 'Coverage Needed',
                resB: 'Deals to Support'
            },
            isMoney: true
        },
        'ECOMM': {
             lbl: {
                q25: '2025 Revenue ($)', q25tip: 'Total eComm revenue target.',
                a25: '2025 Actuals ($)', a25tip: 'Total revenue achieved.',
                e25: 'Conversion Rate %', e25tip: 'Visitor to purchaser rate.',
                d25: 'Avg Order Value ($)', d25tip: 'Average value per transaction.',
                q26: '2026 Revenue ($)',
                resA: 'Traffic/Leads Needed',
                resB: 'Transactions Needed'
            },
            isMoney: true
        },
        'COMPLIANCE': {
            lbl: {
                q25: '2025 Objectives', q25tip: 'Number of key objectives.',
                a25: 'Completed', a25tip: 'Number completed.',
                e25: 'Completion %', e25tip: 'Percentage completed.',
                d25: 'N/A', d25tip: 'Enter 0.',
                q26: '2026 Objectives',
                resA: 'Gap',
                resB: 'Notes'
            },
            isMoney: false,
            skipMath: true
        }
    };

    const $ = (id) => document.getElementById(id);
    const getVal = (id) => parseFloat($(id).value.replace(/,/g, '')) || 0;
    const setTxt = (id, txt) => { if($(id)) $(id).textContent = txt; };
    const fmt$ = (n) => '$' + n.toLocaleString('en-US', {maximumFractionDigits:0});
    const fmtN = (n) => n.toLocaleString('en-US', {maximumFractionDigits:1});

    // --- APP LOGIC ---
    let step = 0; 
    const maxStep = 5;

    function updateLabels() {
        const r = $('userRole').value;
        const d = ROLE_DATA[r].lbl;
        
        // Update Labels
        setTxt('lbl-quota25', d.q25); setTxt('tip-quota25', d.q25tip);
        setTxt('lbl-actual25', d.a25); setTxt('tip-actual25', d.a25tip);
        setTxt('lbl-efficiency25', d.e25); setTxt('tip-efficiency25', d.e25tip);
        setTxt('lbl-dealSize25', d.d25); setTxt('tip-dealSize25', d.d25tip);
        setTxt('lbl-quota26', d.q26);
        setTxt('lbl-resultA', d.resA);
        setTxt('lbl-resultB', d.resB);

        // Handle Compliance special case
        const isComp = (r === 'COMPLIANCE');
        $('calc-section').style.display = isComp ? 'none' : 'block';
    }

    function doMath() {
        const r = $('userRole').value;
        const conf = ROLE_DATA[r];

        const q25 = getVal('val-quota25');
        const a25 = getVal('val-actual25');
        
        // Attainment
        const att = q25 > 0 ? (a25 / q25) * 100 : 0;
        setTxt('calc-attainment', att.toFixed(1) + '%');

        if(conf.skipMath) return;

        const eff = getVal('val-efficiency25') / 100;
        const size = getVal('val-dealSize25');
        const q26 = getVal('val-quota26');

        // Calc A: "Pipeline/Volume Needed" = Target / Efficiency
        const valA = eff > 0 ? q26 / eff : 0;
        
        // Calc B: "Deals/Trans Needed"
        let valB = 0;
        if(size > 0) {
            valB = valA / size; 
        } else {
            // Fallback for SDRs if no deal size
            valB = valA; 
        }

        setTxt('calc-resultA', conf.isMoney ? fmt$(valA) : fmtN(valA));
        setTxt('calc-resultB', fmtN(valB));
    }

    function validate() {
        let valid = true;
        // Check all visible required inputs
        const currentPanel = $(`step-${step}`);
        const inputs = currentPanel.querySelectorAll('.required');
        
        inputs.forEach(inp => {
            const err = inp.nextElementSibling;
            if(!inp.value.trim()) {
                inp.classList.add('input-error');
                if(err && err.classList.contains('error-text')) err.classList.add('show');
                valid = false;
            } else {
                inp.classList.remove('input-error');
                if(err) err.classList.remove('show');
            }
        });

        // Radio Check (Step 3 only)
        if(step === 3 && $('userRole').value !== 'COMPLIANCE') {
            const checked = document.querySelector('input[name="reflection"]:checked');
            const err = $('err-reflection');
            if(!checked) {
                err.classList.add('show');
                valid = false;
            } else {
                err.classList.remove('show');
            }
        }

        return valid;
    }

    function generateSummary() {
        return `TRIMBLE 2026 SUCCESS PLAN
---------------------------
Name: ${$('personName').value}
Role: ${$('userRole').value}
Region: ${$('region').value}

BASELINE (2025)
- Target: ${$('val-quota25').value}
- Actual: ${$('val-actual25').value}
- Attainment: ${$('calc-attainment').textContent}
- Efficiency: ${$('val-efficiency25').value}%

2026 GOALS
- New Target: ${$('val-quota26').value}
- Required Volume: ${$('calc-resultA').textContent}
- Reflection: ${document.querySelector('input[name="reflection"]:checked')?.value || 'N/A'}

ACTION PLAN
1. People: ${$('act-people').value}
2. Process: ${$('act-process').value}
3. Productivity: ${$('act-prod').value}
4. Accuracy: ${$('act-forecast').value}
`;
    }

    function navigate(dir) {
        if(dir === 1 && !validate()) return;

        // Hide current
        $(`step-${step}`).classList.add('hidden');
        
        step += dir;

        // Show new
        $(`step-${step}`).classList.remove('hidden');

        // Update UI
        const isStart = (step === 0);
        const isFinal = (step === maxStep);

        // Progress Bar
        $('progress-bar').style.display = (step >= 2) ? 'flex' : 'none';
        if(step >= 2) {
            ['baseline','gap','solution','review'].forEach((id, i) => {
                const el = $(`tab-${id}`);
                el.className = 'progress-step';
                if(i + 2 === step) el.classList.add('active'); // current
                if(i + 2 < step) el.classList.add('completed'); // past
            });
        }

        // Nav Buttons
        const nextBtn = $('btn-next');
        const prevBtn = $('btn-prev');
        const navArea = $('nav-area');
        const finalBtns = $('final-buttons');

        if(isStart) {
            prevBtn.classList.add('hidden');
            nextBtn.textContent = 'Start';
            navArea.classList.add('justify-center'); // Center button on welcome
        } else {
            prevBtn.classList.remove('hidden');
            navArea.classList.remove('justify-center');
        }

        if(step === 1) nextBtn.textContent = 'Next';
        
        if(isFinal) {
            nextBtn.classList.add('hidden');
            finalBtns.classList.remove('hidden');
            $('summary-display').textContent = generateSummary();
        } else {
            nextBtn.classList.remove('hidden');
            finalBtns.classList.add('hidden');
        }

        // Scroll to top
        window.scrollTo(0,0);
    }

    // --- EVENT LISTENERS ---
    $('btn-next').onclick = () => navigate(1);
    $('btn-prev').onclick = () => navigate(-1);
    
    // Live Math & Role Updates
    $('userRole').onchange = () => { updateLabels(); doMath(); };
    document.querySelectorAll('input').forEach(i => {
        i.oninput = doMath;
    });

    // Final Buttons
    $('btn-restart').onclick = () => {
        if(confirm("Start over?")) location.reload();
    };
    $('btn-copy').onclick = () => {
        navigator.clipboard.writeText($('summary-display').textContent);
        alert("Copied to clipboard!");
    };
    $('btn-pdf').onclick = () => window.print();
    $('btn-json').onclick = () => {
        const data = {
            user: $('personName').value,
            role: $('userRole').value,
            date: new Date().toISOString(),
            plan: $('summary-display').textContent
        };
        const blob = new Blob([JSON.stringify(data, null, 2)], {type:'application/json'});
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = 'trimble-plan.json';
        a.click();
    };

    // Init
    updateLabels();
</script>

</body>
</html>
