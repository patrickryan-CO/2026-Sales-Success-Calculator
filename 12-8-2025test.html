<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trimble 2026 Success Plan</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary': '#0063a3',       // Trimble Blue
                        'primary-hover': '#004a7c', 
                        'accent': '#fbad26',        // Trimble Amber
                        'primary-text': '#252a2e',  // Dark Gray
                        'icon-people': '#6f42c1',    
                        'icon-pipeline': '#007bff',
                        'icon-prod': '#fd7e14',      
                    },
                    fontFamily: {
                        'sans': ['Open Sans', 'sans-serif']
                    }
                }
            }
        }
    </script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
        /* Global Styles */
        body {
            font-family: 'Open Sans', sans-serif;
            color: #252a2e;
            background-color: #f3f4f6;
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }

        /* --- Blue Wave Background --- */
        .wave-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 350px;
            background-color: #0063a3;
            z-index: 0; 
        }
        .wave-svg {
            position: absolute;
            bottom: -1px;
            left: 0;
            width: 100%;
            height: auto;
            display: block;
        }

        /* --- Main Card --- */
        .main-card {
            position: relative;
            z-index: 10;
            background-color: white;
            border-radius: 0.75rem;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
            width: 95%;
            max-width: 64rem;
            margin: 2rem auto 5rem auto;
            padding: 0;
            overflow: hidden;
        }
        
        .card-content { padding: 1.5rem; }
        @media (min-width: 768px) {
            .card-content { padding: 2.5rem; }
            .main-card { margin-top: 5rem; }
        }

        /* Coaching/Context Styles */
        .coach-note {
            font-size: 0.9rem;
            color: #4B5563;
            background-color: #F9FAFB;
            border-left: 4px solid #fbad26;
            padding: 1rem;
            margin-bottom: 1.5rem;
            border-radius: 0 0.5rem 0.5rem 0;
            line-height: 1.5;
        }
        .coach-note strong { color: #0063a3; }

        /* Typography */
        h1, h2, h3, h4, h5, h6 { color: #252a2e !important; }
        .step-heading { font-size: 1.5rem; font-weight: 800; color: #0063a3; margin-bottom: 1rem; padding-bottom: 0.5rem; border-bottom: 1px solid #e5e7eb; }

        /* Inputs */
        .input-label { display: block; font-size: 0.9rem; font-weight: 700; color: #252a2e; margin-bottom: 0.375rem; }
        .input-field {
            display: block; width: 100%; border-radius: 0.375rem; border: 1px solid #D1D5DB;
            padding: 0.75rem; box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05); color: #252a2e;
            transition: all 0.2s; font-size: 1rem;
        }
        .input-field:focus { outline: none; border-color: #0063a3; ring: 2px; ring-color: rgba(0,99,163,0.2); }

        /* Buttons */
        .btn {
            display: inline-block; font-weight: 700; text-align: center; white-space: nowrap;
            vertical-align: middle; user-select: none; border: 1px solid transparent;
            padding: 0.75rem 1.5rem; font-size: 1rem; line-height: 1.5; border-radius: 0.375rem;
            transition: all 0.15s ease-in-out; cursor: pointer; width: 100%;
        }
        @media (min-width: 640px) { .btn { width: auto; } }

        .btn-primary { background-color: #0063a3; color: white; }
        .btn-primary:hover { background-color: #004a7c; }
        
        .btn-accent { background-color: #fbad26; color: #252a2e; }
        .btn-accent:hover { background-color: #e59d20; }
        
        .btn-secondary { background-color: white; color: #B91C1C; border-color: #D1D5DB; }
        .btn-secondary:hover { background-color: #F3F4F6; }

        .btn-default { background-color: #E5E7EB; color: #252a2e; }
        .btn-default:hover { background-color: #D1D5DB; }

        /* Progress Bar */
        .progress-bar-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr); 
            width: 100%;
            border-bottom: 2px solid #E5E7EB;
            margin-bottom: 2rem;
        }
        .progress-step { 
            padding: 0.5rem 0.25rem; 
            text-align: center; 
            font-size: 0.7rem; 
            font-weight: 600; 
            color: #9CA3AF; 
            border-bottom: 4px solid transparent; 
        }
        @media (min-width: 768px) { .progress-step { font-size: 0.875rem; padding: 0.75rem; } }
        .progress-step-active { color: #0063a3; border-bottom-color: #0063a3; }

        /* Results Box */
        .calc-box {
            background-color: #F9FAFB;
            border: 1px solid #E5E7EB;
            border-radius: 0.5rem;
            padding: 1rem;
            text-align: center;
        }
        .calc-output {
            display: block;
            font-size: 1.5rem;
            font-weight: 800;
            color: #0063a3;
            margin-top: 0.25rem;
        }

        /* Print */
        @media print {
            body { background: white; }
            .wave-container, #welcome-screen, #navigation-buttons, .progress-bar-grid, .coach-note { display: none !important; }
            .main-card { box-shadow: none; margin: 0; width: 100%; max-width: 100%; padding: 0; }
            #wizard-container, .step-panel, .hidden { display: block !important; visibility: visible !important; }
            .step-panel { page-break-after: always; margin-bottom: 3rem; }
        }
    </style>
</head>
<body>

    <div class="wave-container">
        <svg class="wave-svg" viewBox="0 0 1440 320" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="none">
            <path fill="#f3f4f6" fill-opacity="1" d="M0,160L48,176C96,192,192,224,288,218.7C384,213,480,171,576,149.3C672,128,768,128,864,149.3C960,171,1056,213,1152,218.7C1248,224,1344,192,1392,176L1440,160L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path>
        </svg>
    </div>

    <div class="main-card">
        <div class="card-content">
            
            <div id="welcome-screen">
                <div class="text-center space-y-8">
                    
                    <div class="space-y-2">
                        <h1 class="text-3xl md:text-4xl font-extrabold text-primary-text">Trimble 2026 Success Plan</h1>
                        <p class="text-lg md:text-xl font-medium text-gray-500">Own Your Number. Build Your Path.</p>
                    </div>

                    <div class="max-w-3xl mx-auto space-y-4">
                        <h2 class="text-2xl font-bold text-primary-text">Your Plan. Your Year.</h2>
                        <p class="text-gray-600 text-lg leading-relaxed">
                            This tool is your personal coach. It helps you translate your quota into a set of clear, measurable actions you can take every day.
                        </p>
                    </div>

                    <div class="bg-blue-50 border border-blue-100 rounded-lg p-8 text-left">
                        <h3 class="text-primary-text font-bold text-xl mb-3">Why This Matters:</h3>
                        <p class="text-gray-700 mb-4 leading-relaxed">
                            This is not a one-time exercise. This plan creates the <strong>"Contract for Success"</strong> that you and your manager will use to track progress, identify gaps, and celebrate wins throughout 2026.
                        </p>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 text-left">
                        <div class="p-6 border border-gray-200 rounded-lg bg-white shadow-sm hover:shadow-md transition-shadow">
                            <div class="text-icon-people mb-4">
                                <svg class="w-10 h-10" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>
                            </div>
                            <h3 class="text-xl font-bold text-primary-text mb-2">People</h3>
                            <ul class="text-sm text-gray-600 list-disc list-inside space-y-2">
                                <li>Identify specific skill gaps</li>
                                <li>Commit to a coaching plan</li>
                            </ul>
                        </div>

                        <div class="p-6 border border-gray-200 rounded-lg bg-white shadow-sm hover:shadow-md transition-shadow">
                            <div class="text-icon-pipeline mb-4">
                                <svg class="w-10 h-10" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path></svg>
                            </div>
                            <h3 class="text-xl font-bold text-primary-text mb-2">Pipeline</h3>
                            <ul class="text-sm text-gray-600 list-disc list-inside space-y-2">
                                <li>Calculate coverage gaps</li>
                                <li>Define generation strategy</li>
                            </ul>
                        </div>

                        <div class="p-6 border border-gray-200 rounded-lg bg-white shadow-sm hover:shadow-md transition-shadow">
                            <div class="text-icon-prod mb-4">
                                <svg class="w-10 h-10" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                            </div>
                            <h3 class="text-xl font-bold text-primary-text mb-2">Productivity</h3>
                            <ul class="text-sm text-gray-600 list-disc list-inside space-y-2">
                                <li>Audit your calendar</li>
                                <li>Protect time for selling</li>
                            </ul>
                        </div>
                    </div>

                    <div class="pt-6 border-t border-gray-100">
                        <button type="button" id="startBtn" class="btn btn-primary text-lg px-10 py-4 shadow-lg w-full md:w-auto">
                            Start My Plan
                        </button>
                    </div>
                </div>
            </div>

            <div id="wizard-container" class="hidden">
                
                <div class="mb-6 text-center">
                    <h1 class="text-2xl md:text-3xl font-extrabold text-primary-text">My 2026 Commitment</h1>
                </div>

                <div class="progress-bar-grid">
                    <div id="progress-1" class="progress-step progress-step-active">1. Baseline</div>
                    <div id="progress-2" class="progress-step">2. Target</div>
                    <div id="progress-3" class="progress-step">3. Levers</div>
                    <div id="progress-4" class="progress-step">4. Actions</div>
                    <div id="progress-5" class="progress-step">5. Submit</div>
                </div>

                <form id="skoForm" onsubmit="return false;">

                    <div id="step-1-content" class="step-panel">
                        <section>
                            <h2 class="step-heading">Step 1 : My Look Back 2025</h2>
                            <div class="coach-note">
                                <strong>Why?</strong> This establishes your personal efficiency baseline. Be honest with these numbers (especially <strong>Win Rate</strong> and <strong>Avg Deal Size</strong>) so we can build a realistic path to your 2026 goal.
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label class="input-label">My Name:</label>
                                    <input type="text" id="personName" name="entry.1533888544" class="input-field" placeholder="e.g., Jane Doe">
                                </div>
                                <div>
                                    <label class="input-label">My Manager's Name:</label>
                                    <input type="text" id="managerName" name="entry.2004467893" class="input-field" placeholder="e.g., John Smith">
                                </div>
                                <div class="md:col-span-2">
                                    <label class="input-label">My Region:</label>
                                    <select id="region" name="entry.909220528" class="input-field">
                                        <option value="" disabled selected>Select your region</option>
                                        <option value="NA">NA (North America)</option>
                                        <option value="EMEA">EMEA</option>
                                        <option value="APAC">APAC</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="input-label">2025 Quota ($):</label>
                                    <input type="text" id="quota2025" class="input-field" placeholder="e.g., 1,000,000">
                                </div>
                                <div>
                                    <label class="input-label">2025 Bookings ($):</label>
                                    <input type="text" id="bookings2025" class="input-field" placeholder="e.g., 1,100,000">
                                </div>
                                <div>
                                    <label class="input-label">My 2025 Win Rate (%):</label>
                                    <input type="number" id="winRate2025" class="input-field" placeholder="e.g., 25">
                                </div>
                                <div>
                                    <label class="input-label">My 2025 Avg. Deal Size ($):</label>
                                    <input type="text" id="avgDealSize2025" class="input-field" placeholder="e.g., 50,000">
                                </div>
                                <div class="calc-box">
                                    <span class="text-sm font-medium text-gray-700">2025 Attainment</span>
                                    <span id="attainment2025" class="calc-output">0%</span>
                                </div>
                            </div>
                        </section>
                    </div>

                    <div id="step-2-content" class="step-panel hidden">
                        <section>
                            <h2 class="step-heading">Step 2 : Pipeline Target</h2>
                            <div class="coach-note">
                                <strong>The Gap:</strong> The tool calculates the pipeline you need based on your 2025 efficiency. If the number looks high, don't panic! Step 3 is about how we lower that number through better <strong>Qualification</strong> and <strong>Cross-Selling</strong>.
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label class="input-label text-lg">My 2026 Quota (Goal):</label>
                                    <input type="text" id="quota2026" name="entry.1187258724" class="input-field" placeholder="e.g., 1,200,000">
                                </div>
                                <div></div> <div class="calc-box">
                                    <span class="text-sm font-medium text-gray-700">Required Pipeline (at current efficiency)</span>
                                    <span id="pipelineToClose2026" class="calc-output">$0</span>
                                    <span class="text-xs text-gray-500 block mt-1">(Quota / Win Rate)</span>
                                </div>
                                <div class="calc-box">
                                    <span class="text-sm font-medium text-gray-700">Deals to Close</span>
                                    <span id="dealsToClose2026" class="calc-output">0</span>
                                    <span class="text-xs text-gray-500 block mt-1">(Pipeline / Deal Size)</span>
                                </div>
                            </div>
                            
                            <div class="mt-8">
                                <label class="input-label">Reflection: Based on these numbers, does your goal feel achievable?</label>
                                <div class="flex flex-wrap gap-4 mt-3">
                                    <label class="flex items-center space-x-2">
                                        <input type="radio" name="reflection" value="Achievable" class="h-5 w-5 text-primary">
                                        <span>Achievable</span>
                                    </label>
                                    <label class="flex items-center space-x-2">
                                        <input type="radio" name="reflection" value="Challenging" class="h-5 w-5 text-primary">
                                        <span>Challenging</span>
                                    </label>
                                    <label class="flex items-center space-x-2">
                                        <input type="radio" name="reflection" value="Impossible" class="h-5 w-5 text-primary">
                                        <span>Impossible</span>
                                    </label>
                                </div>
                            </div>
                        </section>
                    </div>

                    <div id="step-3-content" class="step-panel hidden">
                        <section>
                            <h2 class="step-heading">Step 3 : Scenario Modeling</h2>
                            <div class="coach-note">
                                <strong>Instructions:</strong> Use the sliders to model efficiency gains. Improving <strong>Win Rate</strong> (better qualification) or <strong>Deal Size</strong> (bundling Viewpoint/Tekla) drastically reduces the pipeline you need to generate.
                            </div>

                            <div class="space-y-8">
                                <div class="bg-white border border-gray-200 rounded-lg p-6 shadow-sm">
                                    <h3 class="text-lg font-bold text-primary mb-2">Lever 1: Win Rate (Quality)</h3>
                                    <p class="text-sm text-gray-600 mb-4">Better qualification means less wasted time. <strong>Target:</strong> Improve by <span id="winRateImprovementLabel" class="font-bold text-primary">5.0%</span></p>
                                    <input type="range" id="winRateImprovement" min="0" max="25" value="5" step="0.5" class="w-full">
                                    <div class="mt-4 p-4 bg-blue-50 rounded text-center">
                                        <span class="text-sm text-gray-600">New Pipeline Needed:</span>
                                        <div id="newPipelineNeeded" class="text-2xl font-bold text-primary">$0</div>
                                    </div>
                                </div>

                                <div class="bg-white border border-gray-200 rounded-lg p-6 shadow-sm">
                                    <h3 class="text-lg font-bold text-primary mb-2">Lever 2: Avg. Deal Size (Value)</h3>
                                    <p class="text-sm text-gray-600 mb-4">Bundling software & hardware increases deal size. <strong>Target:</strong> Improve by <span id="dealSizeImprovementLabel" class="font-bold text-primary">15%</span></p>
                                    <input type="range" id="dealSizeImprovement" min="0" max="50" value="15" step="1" class="w-full">
                                    <div class="mt-4 p-4 bg-blue-50 rounded text-center">
                                        <span class="text-sm text-gray-600">New Deals Needed:</span>
                                        <div id="newDealsNeeded" class="text-2xl font-bold text-primary">0</div>
                                    </div>
                                </div>

                                <div class="bg-white border border-gray-200 rounded-lg p-6 shadow-sm">
                                    <h3 class="text-lg font-bold text-primary mb-2">Lever 3: Meetings (Activity)</h3>
                                    <p class="text-sm text-gray-600 mb-4">Face-time drives predictability. <strong>Target:</strong> <span id="meetingImprovementLabel" class="font-bold text-primary">5</span> more meetings/quarter.</p>
                                    <input type="range" id="meetingImprovement" min="0" max="20" value="5" step="1" class="w-full">
                                    <div class="mt-4">
                                        <label class="input-label text-sm">Implied New Win Rate (%):</label>
                                        <input type="number" id="meetingsImpliedWinRate" class="input-field" placeholder="e.g., 28">
                                    </div>
                                </div>
                            </div>
                        </section>
                    </div>

                    <div id="step-4-content" class="step-panel hidden">
                        <section>
                            <h2 class="step-heading">Step 4 : My Action Plan</h2>
                            <div class="coach-note">
                                <strong>Commitment:</strong> Define the <strong>measurable actions</strong> you will take. Example: <em>"I will block 2 hours every Friday for prospecting"</em> or <em>"I will complete my 'Connect & Scale' certification by Q2."</em>
                            </div>

                            <div class="space-y-6">
                                <div>
                                    <label class="input-label text-lg">My Primary Focus Goal (Select all that apply):</label>
                                    <div class="flex flex-col gap-3 mt-3">
                                        <label class="flex items-center space-x-3 p-3 border rounded bg-white hover:bg-gray-50 cursor-pointer">
                                            <input type="checkbox" name="entry.1090213679" value="Win Rate" class="h-5 w-5 text-primary">
                                            <span class="text-primary-text font-medium">Win Rate</span>
                                        </label>
                                        <label class="flex items-center space-x-3 p-3 border rounded bg-white hover:bg-gray-50 cursor-pointer">
                                            <input type="checkbox" name="entry.1090213679" value="Average Deal Size" class="h-5 w-5 text-primary">
                                            <span class="text-primary-text font-medium">Average Deal Size</span>
                                        </label>
                                        <label class="flex items-center space-x-3 p-3 border rounded bg-white hover:bg-gray-50 cursor-pointer">
                                            <input type="checkbox" name="entry.1090213679" value="Pipeline" class="h-5 w-5 text-primary">
                                            <span class="text-primary-text font-medium">Pipeline</span>
                                        </label>
                                        <label class="flex items-center space-x-3 p-3 border rounded bg-white hover:bg-gray-50 cursor-pointer">
                                            <input type="checkbox" name="entry.1090213679" value="In-Person Meetings" class="h-5 w-5 text-primary">
                                            <span class="text-primary-text font-medium">In-Person Meetings</span>
                                        </label>
                                    </div>
                                </div>

                                <div>
                                    <label class="input-label">Action: People (Skills & Knowledge):</label>
                                    <p class="text-xs text-gray-500 mb-1">e.g., "I will complete my Viewpoint certification by Q2."</p>
                                    <input type="text" id="action-people" name="entry.1667466065" class="input-field">
                                </div>

                                <div>
                                    <label class="input-label">Action: Productivity (Process & Time):</label>
                                    <p class="text-xs text-gray-500 mb-1">e.g., "I will block 2 hours every Friday for prospecting."</p>
                                    <input type="text" id="action-productivity" name="entry.1571167359" class="input-field">
                                </div>

                                <div>
                                    <label class="input-label">Forecasting Commitment:</label>
                                    <p class="text-xs text-gray-500 mb-1">How will you ensure 95-105% accuracy?</p>
                                    <input type="text" id="action-forecast" name="entry.962991132" class="input-field">
                                </div>
                            </div>
                        </section>
                    </div>
                    
                    <div id="step-5-content" class="step-panel hidden">
                        <section>
                            <h2 class="step-heading">Step 5 : Final Review</h2>
                            <div class="coach-note">
                                <strong>Instructions:</strong> Review your plan below. <br>
                                1. Click <strong>"Save as PDF"</strong> for your records.<br>
                                2. Click <strong>"Review Your Plan"</strong> to submit your commitment to your manager via Google Forms.
                            </div>
                            
                            <div id="commitmentSummaryOutput" class="bg-gray-100 p-6 rounded-lg text-sm text-primary-text whitespace-pre-wrap border border-gray-300 font-mono mb-6">
                                Plan details will load here...
                            </div>
                        </section>
                    </div>

                    <div id="navigation-buttons" class="mt-8 pt-6 border-t border-gray-300 flex justify-between items-center">
                        <button type="button" id="prevButton" class="btn btn-default hidden">Previous</button>
                        <div class="flex-grow"></div>
                        <div class="nav-button-group">
                             <button type="button" id="resetButton" class="btn btn-secondary hidden">Start Over</button>
                             <button type="button" id="printButton" class="btn btn-default hidden">Save as PDF</button>
                             
                             <button type="button" id="submitToFormButton" class="btn btn-accent hidden font-bold">
                                 Review Your Plan
                             </button>
                             
                             <button type="button" id="nextButton" class="btn btn-primary">Next</button>
                        </div>
                    </div>

                </form>
            </div>
        </div>
    </div>

<script>
    // --- 1. GOOGLE FORM CONFIGURATION ---
    const GOOGLE_FORM_CONFIG = {
        baseUrl: "https://docs.google.com/forms/d/e/1FAIpQLSdVizNI9jeThAxWU2FjxTcqaVfdsnXqaDbbDMzHg8Y4gGX1Hg/viewform",
        fields: {
            repName: "entry.1533888544", 
            managerName: "entry.2004467893", 
            region: "entry.909220528",
            quota2026: "entry.1187258724", 
            targetWinRate: "entry.516044971", 
            targetCoverage: "entry.10775378",
            primaryGoal: "entry.1090213679", // Checkbox Field ID
            peoplePlan: "entry.1667466065", 
            productivityPlan: "entry.1571167359", 
            forecastCommit: "entry.962991132"
        }
    };

    // --- Helper Functions ---
    const $ = (selector) => document.getElementById(selector);
    const getNumberValue = (id) => { const el = $(id); return el ? (parseFloat(el.value.replace(/[$,]/g, '')) || 0) : 0; };
    const getStringValue = (id) => { const el = $(id); return el ? el.value.trim() : ''; };
    
    // Updated Helper: Collects ALL checked values from checkboxes
    const getMultiSelectValue = (name) => {
        const checked = document.querySelectorAll(`input[name="${name}"]:checked`);
        return Array.from(checked).map(cb => cb.value).join(', ') || '[Not Selected]';
    };
    
    const formatCurrency = (val) => '$' + (val || 0).toLocaleString('en-US', { maximumFractionDigits: 0 });
    const formatPercent = (val) => (val || 0).toFixed(1) + '%';
    const formatNumber = (val) => (val || 0).toLocaleString('en-US', { maximumFractionDigits: 1 });
    const formatCoverage = (val) => (val || 0).toFixed(1) + 'x';

    // --- Core Logic ---
    function calculatePlan() {
        // Inputs
        const quota2025 = getNumberValue('quota2025');
        const bookings2025 = getNumberValue('bookings2025');
        const winRate2025 = getNumberValue('winRate2025');
        const avgDealSize2025 = getNumberValue('avgDealSize2025');
        const quota2026 = getNumberValue('quota2026');
        const winRateImprovement = getNumberValue('winRateImprovement');
        const dealSizeImprovement = getNumberValue('dealSizeImprovement');
        const meetingImprovement = getNumberValue('meetingImprovement');
        const meetingsImpliedWinRate = getNumberValue('meetingsImpliedWinRate');

        // Phase 1
        const attainment2025 = quota2025 > 0 ? (bookings2025 / quota2025) * 100 : 0;
        if($('attainment2025')) $('attainment2025').textContent = formatPercent(attainment2025);

        // Phase 2
        const winRateDecimal = winRate2025 / 100;
        const pipelineToClose2026 = winRateDecimal > 0 ? quota2026 / winRateDecimal : 0;
        if($('pipelineToClose2026')) $('pipelineToClose2026').textContent = formatCurrency(pipelineToClose2026);
        if($('dealsToClose2026')) $('dealsToClose2026').textContent = formatNumber(avgDealSize2025 > 0 ? pipelineToClose2026 / avgDealSize2025 : 0);

        // Phase 3
        const newWinRate = winRate2025 + winRateImprovement;
        const newPipelineNeeded = (newWinRate/100) > 0 ? quota2026 / (newWinRate/100) : 0;
        if($('winRateImprovementLabel')) $('winRateImprovementLabel').textContent = `${winRateImprovement.toFixed(1)}%`;
        if($('newPipelineNeeded')) $('newPipelineNeeded').textContent = formatCurrency(newPipelineNeeded);

        const newAvgDealSize = avgDealSize2025 * (1 + (dealSizeImprovement / 100));
        const newDealsNeeded = newAvgDealSize > 0 ? quota2026 / newAvgDealSize : 0;
        if($('dealSizeImprovementLabel')) $('dealSizeImprovementLabel').textContent = `${dealSizeImprovement.toFixed(0)}%`;
        if($('newDealsNeeded')) $('newDealsNeeded').textContent = formatNumber(newDealsNeeded);
        
        if($('meetingImprovementLabel')) $('meetingImprovementLabel').textContent = meetingImprovement;
        
        if (currentStep === 5) generateCommitmentSummary();
    }
    
    function generateCommitmentSummary() {
        // Use multi-select helper
        const primaryFocus = getMultiSelectValue(GOOGLE_FORM_CONFIG.fields.primaryGoal);

        const summaryText = `
**TRIMBLE 2026 SALES PLAN**
Rep: ${getStringValue('personName')}
Quota: ${formatCurrency(getNumberValue('quota2026'))}
Win Rate Goal: ${formatPercent(getNumberValue('winRate2025') + getNumberValue('winRateImprovement'))}
Primary Focus: ${primaryFocus}
Action (People): ${getStringValue('action-people')}
Action (Productivity): ${getStringValue('action-productivity')}
Action (Forecast): ${getStringValue('action-forecast')}
        `.trim();
        
        $('commitmentSummaryOutput').textContent = summaryText;
        return summaryText;
    }

    // --- FORM SUBMISSION LOGIC ---
    function submitToGoogleForm() {
        const c = GOOGLE_FORM_CONFIG;
        const wr = getNumberValue('winRate2025') + getNumberValue('winRateImprovement');
        const cov = wr > 0 ? (1 / (wr / 100)).toFixed(1) : "0.0";
        
        // 1. Gather Basic Fields
        let url = `${c.baseUrl}?${c.fields.repName}=${encodeURIComponent(getStringValue('personName'))}` +
            `&${c.fields.managerName}=${encodeURIComponent(getStringValue('managerName'))}` +
            `&${c.fields.region}=${encodeURIComponent($('region').value)}` +
            `&${c.fields.quota2026}=${encodeURIComponent(getNumberValue('quota2026'))}` +
            `&${c.fields.targetWinRate}=${encodeURIComponent(wr)}` +
            `&${c.fields.targetCoverage}=${encodeURIComponent(cov)}` +
            `&${c.fields.peoplePlan}=${encodeURIComponent(getStringValue('action-people'))}` +
            `&${c.fields.productivityPlan}=${encodeURIComponent(getStringValue('action-productivity'))}` +
            `&${c.fields.forecastCommit}=${encodeURIComponent(getStringValue('action-forecast'))}`;

        // 2. Gather Checkboxes (Loop through all checked inputs for Primary Goal)
        const checkedBoxes = document.querySelectorAll(`input[name="${c.fields.primaryGoal}"]:checked`);
        checkedBoxes.forEach(cb => {
            url += `&${c.fields.primaryGoal}=${encodeURIComponent(cb.value)}`;
        });
            
        window.open(url, '_blank');
    }

    // --- Navigation Logic ---
    let currentStep = 1;
    const totalSteps = 5; 

    // View Controller
    const views = {
        welcome: $('welcome-screen'),
        wizard: $('wizard-container')
    };

    function initViews() {
        views.welcome.style.display = 'block';
        views.wizard.classList.add('hidden');
        window.scrollTo(0,0);
    }

    $('startBtn').addEventListener('click', () => {
        views.welcome.style.display = 'none';
        views.wizard.classList.remove('hidden');
        calculatePlan();
        window.scrollTo(0,0);
    });

    function showStep(step) {
        if (step === 5) generateCommitmentSummary();
        
        for (let i = 1; i <= totalSteps; i++) {
            $(`step-${i}-content`).classList.add('hidden');
            $(`progress-${i}`).classList.remove('progress-step-active');
        }
        $(`step-${step}-content`).classList.remove('hidden');
        for (let i = 1; i <= step; i++) $(`progress-${i}`).classList.add('progress-step-active');
        
        const isFinalStep = (step === totalSteps);
        
        // Button Logic
        const prevBtn = $('prevButton');
        const nextBtn = $('nextButton');
        const submitBtn = $('submitToFormButton');
        const printBtn = $('printButton');
        const resetBtn = $('resetButton');

        prevBtn.classList.toggle('hidden', step === 1);
        
        if (isFinalStep) {
            nextBtn.classList.add('hidden');
            submitBtn.classList.remove('hidden');
            printBtn.classList.remove('hidden');
            resetBtn.classList.remove('hidden');
        } else {
            nextBtn.classList.remove('hidden');
            nextBtn.textContent = 'Next';
            nextBtn.classList.remove('btn-accent');
            nextBtn.classList.add('btn-primary');
            submitBtn.classList.add('hidden');
            printBtn.classList.add('hidden');
            resetBtn.classList.add('hidden');
        }
        
        // Scroll to heading of new step
        const heading = $(`step-${step}-content`).querySelector('.step-heading');
        if (heading) heading.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    document.addEventListener('DOMContentLoaded', () => {
        initViews();

        const inputs = document.querySelectorAll('input, select');
        inputs.forEach(el => {
            el.addEventListener('input', calculatePlan);
            // Enter key navigation
            el.addEventListener('keydown', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    if(currentStep < totalSteps) {
                        currentStep++;
                        showStep(currentStep);
                    }
                }
            });
        });

        $('nextButton').addEventListener('click', () => { if(currentStep < totalSteps) { currentStep++; showStep(currentStep); }});
        $('prevButton').addEventListener('click', () => { if(currentStep > 1) { currentStep--; showStep(currentStep); }});
        $('resetButton').addEventListener('click', () => { 
            if(confirm("Start over? All data will be lost.")) {
                $('skoForm').reset(); calculatePlan(); currentStep = 1; showStep(1); 
            }
        });
        
        $('printButton').addEventListener('click', () => {
            if(confirm("Is this your final, correct plan?")) window.print();
        });
        
        $('submitToFormButton').addEventListener('click', submitToGoogleForm);

        calculatePlan();
    });
</script>
</body>
</html>
